queries:
- group: general
  desc: List all AbuseTGTDelegation privileges
  cypher: |-
    MATCH (n)-[r:AbuseTGTDelegation]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AbuseTGTDelegation over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AbuseTGTDelegation privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:AbuseTGTDelegation]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AbuseTGTDelegation over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AbuseTGTDelegation privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:AbuseTGTDelegation]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AbuseTGTDelegation over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCS privileges
  cypher: |-
    MATCH (n)-[r:ADCSESC1|ADCSESC10a|ADCSESC10b|ADCSESC13|ADCSESC3|ADCSESC4|ADCSESC6a|ADCSESC6b|ADCSESC9a|ADCSESC9b]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n, type(r) AS rel_type
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has {{ rel_type }} over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC1 privileges
  cypher: |-
    MATCH (n)-[r:ADCSESC1]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC1 over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC1 privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:ADCSESC1]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC1 over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC1 privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC1]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC1 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC10a privileges
  cypher: |-
    MATCH (n)-[r:ADCSESC10a]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC10a over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC10a privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:ADCSESC10a]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC10a over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC10a privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC10a]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC10a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC10b privileges
  cypher: |-
    MATCH (n)-[r:ADCSESC10b]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC10b over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC10b privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:ADCSESC10b]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC10b over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC10b privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC10b]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC10b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC13 privileges
  cypher: |-
    MATCH (n)-[r:ADCSESC13]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC13 over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC13 privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:ADCSESC13]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC13 over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC13 privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC13]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC13 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC3 privileges
  cypher: |-
    MATCH (n)-[r:ADCSESC3]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC3 over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC3 privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:ADCSESC3]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC3 over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC3 privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC3]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC3 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC4 privileges
  cypher: |-
    MATCH (n)-[r:ADCSESC4]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC4 over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC4 privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:ADCSESC4]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC4 over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC4 privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC4]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC4 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC6a privileges
  cypher: |-
    MATCH (n)-[r:ADCSESC6a]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC6a over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC6a privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:ADCSESC6a]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC6a over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC6a privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC6a]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC6a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC6b privileges
  cypher: |-
    MATCH (n)-[r:ADCSESC6b]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC6b over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC6b privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:ADCSESC6b]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC6b over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC6b privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC6b]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC6b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC9a privileges
  cypher: |-
    MATCH (n)-[r:ADCSESC9a]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC9a over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC9a privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:ADCSESC9a]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC9a over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC9a privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC9a]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC9a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC9b privileges
  cypher: |-
    MATCH (n)-[r:ADCSESC9b]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC9b over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC9b privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:ADCSESC9b]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ADCSESC9b over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ADCSESC9b privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC9b]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC9b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AddAllowedToAct privileges
  cypher: |-
    MATCH (n)-[r:AddAllowedToAct]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AddAllowedToAct over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AddAllowedToAct privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:AddAllowedToAct]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AddAllowedToAct over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AddAllowedToAct privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:AddAllowedToAct]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AddAllowedToAct over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AddKeyCredentialLink privileges
  cypher: |-
    MATCH (n)-[r:AddKeyCredentialLink]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AddKeyCredentialLink over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AddKeyCredentialLink privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:AddKeyCredentialLink]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AddKeyCredentialLink over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AddKeyCredentialLink privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:AddKeyCredentialLink]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AddKeyCredentialLink over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AddMember privileges
  cypher: |-
    MATCH (n)-[r:AddMember]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AddMember over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all AddMember privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:AddMember]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AddMember over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all AddMember privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:AddMember]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AddMember over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AddSelf privileges
  cypher: |-
    MATCH (n)-[r:AddSelf]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AddSelf over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all AddSelf privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:AddSelf]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AddSelf over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all AddSelf privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:AddSelf]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AddSelf over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AdminTo privileges
  cypher: |-
    MATCH (n)-[r:AdminTo]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AdminTo over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all AdminTo privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:AdminTo]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AdminTo over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all AdminTo privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:AdminTo]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AdminTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AdminTo privileges to Domain Controllers
  cypher: |-
    MATCH (m)-[:AdminTo]->(n:Computer)-[:MemberOf]->(g:Group)
    WHERE g.objectid =~ "(?i)S-1-5-21-.*-516"
    RETURN m.name AS m_name, n.name AS n_name, labels(m) AS labels_m
    ORDER BY m.name
  msg_template: |-
    {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }}) is AdminTo {{ n_name }}
- group: general
  desc: List all AllExtendedRights privileges
  cypher: |-
    MATCH (n)-[r:AllExtendedRights]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AllExtendedRights over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AllExtendedRights privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:AllExtendedRights]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AllExtendedRights over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AllExtendedRights privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:AllExtendedRights]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AllExtendedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AllowedToAct privileges
  cypher: |-
    MATCH (n)-[r:AllowedToAct]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AllowedToAct over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AllowedToAct privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:AllowedToAct]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AllowedToAct over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AllowedToAct privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:AllowedToAct]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AllowedToAct over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AllowedToDelegate privileges
  cypher: |-
    MATCH (n)-[r:AllowedToDelegate]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AllowedToDelegate over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AllowedToDelegate privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:AllowedToDelegate]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has AllowedToDelegate over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AllowedToDelegate privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:AllowedToDelegate]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AllowedToDelegate over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all AS-REP roastable users
  cypher: |-
    MATCH (u:User {dontreqpreauth: true})
    RETURN u.name AS u_name
    ORDER BY u.name
  msg_template: |-
    User {{ u_name }} is AS-REP roastable
- group: general
  desc: List all AS-REP roastable users for owned principals
  cypher: |-
    MATCH (u:User {dontreqpreauth: true, owned: true})
    RETURN u.name AS u_name
    ORDER BY u.name
  msg_template: |-
    User {{ u_name }} is AS-REP roastable
- group: general
  desc: List all CanApplyGPO privileges
  cypher: |-
    MATCH (n)-[r:CanApplyGPO]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CanApplyGPO over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all CanApplyGPO privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:CanApplyGPO]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CanApplyGPO over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all CanApplyGPO privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:CanApplyGPO]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CanApplyGPO over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all CanPSRemote privileges
  cypher: |-
    MATCH (n)-[r:CanPSRemote]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CanPSRemote over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all CanPSRemote privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:CanPSRemote]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CanPSRemote over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all CanPSRemote privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:CanPSRemote]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CanPSRemote over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all CanRDP privileges
  cypher: |-
    MATCH (n)-[r:CanRDP]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CanRDP over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all CanRDP privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:CanRDP]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CanRDP over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all CanRDP privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:CanRDP]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CanRDP over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all CoerceAndRelayNTLMToADCS privileges
  cypher: |-
    MATCH (n)-[r:CoerceAndRelayNTLMToADCS]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CoerceAndRelayNTLMToADCS over {{ m_name }}
    ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all CoerceAndRelayNTLMToADCS privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:CoerceAndRelayNTLMToADCS]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CoerceAndRelayNTLMToADCS over {{ m_name }}
    ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all CoerceAndRelayNTLMToADCS privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:CoerceAndRelayNTLMToADCS]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CoerceAndRelayNTLMToADCS over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all CoerceAndRelayNTLMToLDAP privileges
  cypher: |-
    MATCH (n)-[r:CoerceAndRelayNTLMToLDAP]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CoerceAndRelayNTLMToLDAP over {{ m_name }}
    ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all CoerceAndRelayNTLMToLDAP privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:CoerceAndRelayNTLMToLDAP]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CoerceAndRelayNTLMToLDAP over {{ m_name }}
    ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all CoerceAndRelayNTLMToLDAP privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:CoerceAndRelayNTLMToLDAP]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CoerceAndRelayNTLMToLDAP over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all CoerceAndRelayNTLMToLDAPS privileges
  cypher: |-
    MATCH (n)-[r:CoerceAndRelayNTLMToLDAPS]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CoerceAndRelayNTLMToLDAPS over {{ m_name }}
    ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all CoerceAndRelayNTLMToLDAPS privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:CoerceAndRelayNTLMToLDAPS]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CoerceAndRelayNTLMToLDAPS over {{ m_name }}
    ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all CoerceAndRelayNTLMToLDAPS privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:CoerceAndRelayNTLMToLDAPS]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CoerceAndRelayNTLMToLDAPS over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all CoerceAndRelayNTLMToSMB privileges
  cypher: |-
    MATCH (n)-[r:CoerceAndRelayNTLMToSMB]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CoerceAndRelayNTLMToSMB over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all CoerceAndRelayNTLMToSMB privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:CoerceAndRelayNTLMToSMB]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CoerceAndRelayNTLMToSMB over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all CoerceAndRelayNTLMToSMB privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:CoerceAndRelayNTLMToSMB]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CoerceAndRelayNTLMToSMB over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all CoerceToTGT privileges
  cypher: |-
    MATCH (n)-[r:CoerceToTGT]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CoerceToTGT over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all CoerceToTGT privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:CoerceToTGT]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CoerceToTGT over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all CoerceToTGT privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:CoerceToTGT]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CoerceToTGT over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer AbuseTGTDelegation privileges
  cypher: |-
    MATCH (n:Computer)-[r:AbuseTGTDelegation]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has AbuseTGTDelegation over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer ADCSESC1 privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC1]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC1 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer ADCSESC10a privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC10a]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC10a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer ADCSESC10b privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC10b]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC10b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer ADCSESC13 privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC13]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC13 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer ADCSESC3 privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC3]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC3 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer ADCSESC4 privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC4]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC4 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer ADCSESC6a privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC6a]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC6a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer ADCSESC6b privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC6b]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC6b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer ADCSESC9a privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC9a]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC9a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer ADCSESC9b privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC9b]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC9b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer AddAllowedToAct privileges
  cypher: |-
    MATCH (n:Computer)-[r:AddAllowedToAct]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has AddAllowedToAct over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer AddKeyCredentialLink privileges
  cypher: |-
    MATCH (n:Computer)-[r:AddKeyCredentialLink]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has AddKeyCredentialLink over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all computer AddMember privileges
  cypher: |-
    MATCH (n:Computer)-[r:AddMember]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has AddMember over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer AddSelf privileges
  cypher: |-
    MATCH (n:Computer)-[r:AddSelf]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has AddSelf over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer AdminTo privileges
  cypher: |-
    MATCH (n:Computer)-[r:AdminTo]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has AdminTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer AllExtendedRights privileges
  cypher: |-
    MATCH (n:Computer)-[r:AllExtendedRights]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has AllExtendedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer AllowedToAct privileges
  cypher: |-
    MATCH (n:Computer)-[r:AllowedToAct]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} is AllowedToAct for {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer AllowedToDelegate privileges
  cypher: |-
    MATCH (n:Computer)-[r:AllowedToDelegate]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has AllowedToDelegate over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer CanApplyGPO privileges
  cypher: |-
    MATCH (n:Computer)-[r:CanApplyGPO]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has CanApplyGPO over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer CanPSRemote privileges
  cypher: |-
    MATCH (n:Computer)-[r:CanPSRemote]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has CanPSRemote over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer CanRDP privileges
  cypher: |-
    MATCH (n:Computer)-[r:CanRDP]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has CanRDP over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer CoerceAndRelayNTLMToADCS privileges
  cypher: |-
    MATCH (n:Computer)-[r:CoerceAndRelayNTLMToADCS]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has CoerceAndRelayNTLMToADCS over {{ m_name }} ({{ labels_m[0] }}/{{
    labels_m[1] }})
- group: general
  desc: List all computer CoerceAndRelayNTLMToLDAP privileges
  cypher: |-
    MATCH (n:Computer)-[r:CoerceAndRelayNTLMToLDAP]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has CoerceAndRelayNTLMToLDAP over {{ m_name }} ({{ labels_m[0] }}/{{
    labels_m[1] }})
- group: general
  desc: List all computer CoerceAndRelayNTLMToLDAPS privileges
  cypher: |-
    MATCH (n:Computer)-[r:CoerceAndRelayNTLMToLDAPS]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has CoerceAndRelayNTLMToLDAPS over {{ m_name }} ({{ labels_m[0] }}/{{
    labels_m[1] }})
- group: general
  desc: List all computer CoerceAndRelayNTLMToSMB privileges
  cypher: |-
    MATCH (n:Computer)-[r:CoerceAndRelayNTLMToSMB]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has CoerceAndRelayNTLMToSMB over {{ m_name }} ({{ labels_m[0] }}/{{
    labels_m[1] }})
- group: general
  desc: List all computer CoerceToTGT privileges
  cypher: |-
    MATCH (n:Computer)-[r:CoerceToTGT]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has CoerceToTGT over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer ContainsIdentity privileges
  cypher: |-
    MATCH (n:Computer)-[r:ContainsIdentity]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ContainsIdentity over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer cross-domain DCSync privileges
  cypher: |-
    MATCH p=(n:Computer)-[r:DCSync|AllExtendedRights|GenericAll]->(m:Domain)
    WHERE n.domain <> m.name
    RETURN n.name AS n_name, m.name AS m_name, type(r) AS rel_type
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has {{ rel_type }} privileges for {{ m_name }}
- group: general
  desc: List all computer DCSync privileges
  cypher: |-
    MATCH (n:Computer)-[r:DCSync|AllExtendedRights|GenericAll]->(m:Domain)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, type(r) AS rel_type
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has {{ rel_type }} over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer DumpSMSAPassword privileges
  cypher: |-
    MATCH (n:Computer)-[r:DumpSMSAPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has DumpSMSAPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer ExecuteDCOM privileges
  cypher: |-
    MATCH (n:Computer)-[r:ExecuteDCOM]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ExecuteDCOM over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer ForceChangePassword privileges
  cypher: |-
    MATCH (n:Computer)-[r:ForceChangePassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ForceChangePassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all computer GenericAll privileges
  cypher: |-
    MATCH (n:Computer)-[r:GenericAll]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has GenericAll over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer GenericWrite privileges
  cypher: |-
    MATCH (n:Computer)-[r:GenericWrite]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has GenericWrite over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer GoldenCert privileges
  cypher: |-
    MATCH (n:Computer)-[r:GoldenCert]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has GoldenCert over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer GPOAppliesTo privileges
  cypher: |-
    MATCH (n:Computer)-[r:GPOAppliesTo]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has GPOAppliesTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer group memberships
  cypher: |-
    MATCH (n:Computer)-[r:MemberOf]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} is MemberOf {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer HasSession privileges
  cypher: |-
    MATCH (n:Computer)-[r:HasSession]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has HasSession over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer HasSIDHistory privileges
  cypher: |-
    MATCH (n:Computer)-[r:HasSIDHistory]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has HasSIDHistory over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer HasTrustKeys privileges
  cypher: |-
    MATCH (n:Computer)-[r:HasTrustKeys]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has HasTrustKeys over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer Owns privileges
  cypher: |-
    MATCH (n:Computer)-[r:Owns]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} Owns {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer OwnsLimitedRights privileges
  cypher: |-
    MATCH (n:Computer)-[r:OwnsLimitedRights]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has OwnsLimitedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer privileges
  cypher: |-
    MATCH (n:Computer)-[r]->(m)
    RETURN n.name AS n_name, TYPE(r) AS rel_type, labels(m) AS labels_m, m.name AS m_name
    ORDER BY TYPE(r)
  msg_template: |-
    Computer {{ n_name }} has {{ rel_type }} over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer PropagatesACEsTo privileges
  cypher: |-
    MATCH (n:Computer)-[r:PropagatesACEsTo]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has PropagatesACEsTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer ReadGMSAPassword privileges
  cypher: |-
    MATCH (n:Computer)-[r:ReadGMSAPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ReadGMSAPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer ReadLAPSPassword privileges
  cypher: |-
    MATCH (n:Computer)-[r:ReadLAPSPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ReadLAPSPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer shortest paths to admin groups
  cypher: |-
    MATCH p=shortestPath((m:Computer)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)admin|adm).*" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all computer shortest paths to Domain Admins
  cypher: |-
    MATCH p=shortestPath((m:Computer)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-512" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all computer shortest paths to Domain Controllers
  cypher: |-
    MATCH p=shortestPath((m:Computer)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-516" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all computer shortest paths to domains
  cypher: |-
    MATCH p=shortestPath((m:Computer)-[r*1..]->(n:Domain))
    WHERE NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag") AND NOT m=n
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all computer shortest paths to Enterprise Admins
  cypher: |-
    MATCH p=shortestPath((m:Computer)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-519" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all computer shortest paths to Exchange groups
  cypher: |-
    MATCH p=shortestPath((m:Computer)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)EXCHANGE).*" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all computer shortest paths to high-value targets
  cypher: |-
    MATCH (m:Computer),(n {highvalue: true}),p=shortestPath((m)-[r*1..]->(n))
    WHERE NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag") AND NOT m=n
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all computer shortest paths to service groups
  cypher: |-
    MATCH p=shortestPath((m:Computer)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)service|svc).*" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all computer shortest paths to SQL groups
  cypher: |-
    MATCH p=shortestPath((m:Computer)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)SQL).*" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all computer shortest paths to web groups
  cypher: |-
    MATCH p=shortestPath((m:Computer)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)WEB).*" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all computer SpoofSIDHistory privileges
  cypher: |-
    MATCH (n:Computer)-[r:SpoofSIDHistory]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has SpoofSIDHistory over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer SQLAdmin privileges
  cypher: |-
    MATCH (n:Computer)-[r:SQLAdmin]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has SQLAdmin over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer SyncedToEntraUser privileges
  cypher: |-
    MATCH (n:Computer)-[r:SyncedToEntraUser]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has SyncedToEntraUser over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer SyncLAPSPassword privileges
  cypher: |-
    MATCH (n:Computer)-[r:SyncLAPSPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has SyncLAPSPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer WriteAccountRestrictions privileges
  cypher: |-
    MATCH (n:Computer)-[r:WriteAccountRestrictions]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has WriteAccountRestrictions over {{ m_name }} ({{ labels_m[0] }}/{{
    labels_m[1] }})
- group: general
  desc: List all computer WriteDacl privileges
  cypher: |-
    MATCH (n:Computer)-[r:WriteDacl]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has WriteDacl over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer WriteGPLink privileges
  cypher: |-
    MATCH (n:Computer)-[r:WriteGPLink]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has WriteGPLink over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer WriteOwner privileges
  cypher: |-
    MATCH (n:Computer)-[r:WriteOwner]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has WriteOwner over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computer WriteOwnerLimitedRights privileges
  cypher: |-
    MATCH (n:Computer)-[r:WriteOwnerLimitedRights]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has WriteOwnerLimitedRights over {{ m_name }} ({{ labels_m[0] }}/{{
    labels_m[1] }})
- group: general
  desc: List all computer WriteSPN privileges
  cypher: |-
    MATCH (n:Computer)-[r:WriteSPN]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has WriteSPN over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all computers
  cypher: |-
    MATCH (n:Computer)
    RETURN n.name AS n_name
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }}
- group: general
  desc: List all computers with an admin count
  cypher: |-
    MATCH (m:Computer {admincount: true})
    RETURN m.name AS m_name
    ORDER BY m.name
  msg_template: |-
    Computer {{ m_name }} has an admin count
- group: general
  desc: List all Containers
  cypher: |-
    MATCH (c:Container)
    RETURN c.name AS c_name
    ORDER BY c.name
  msg_template: |-
    Container {{ c_name }}
- group: general
  desc: List all ContainsIdentity privileges
  cypher: |-
    MATCH (n)-[r:ContainsIdentity]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ContainsIdentity over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ContainsIdentity privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:ContainsIdentity]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ContainsIdentity over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ContainsIdentity privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:ContainsIdentity]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ContainsIdentity over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all CrossForestTrust privileges
  cypher: |-
    MATCH (n)-[r:CrossForestTrust]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CrossForestTrust over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all CrossForestTrust privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:CrossForestTrust]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has CrossForestTrust over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all DCFor privileges
  cypher: |-
    MATCH (n)-[r:DCFor]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has DCFor over {{ m_name }} ({{ labels_m[0] }}/{{
    labels_m[1] }})
- group: general
  desc: List all DCSync privileges
  cypher: |-
    MATCH (n)-[r:DCSync|AllExtendedRights|GenericAll]->(m:Domain)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n, type(r) AS rel_type
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has {{ rel_type }} over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all DCSync privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:DCSync|AllExtendedRights|GenericAll]->(m:Domain)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n, type(r) AS rel_type
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has {{ rel_type }} over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all DCSync privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:DCSync|AllExtendedRights|GenericAll]->(m:Domain)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, type(r) AS rel_type
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} has {{ rel_type }} privileges for {{ m_name }}
- group: general
  desc: List all disabled computers
  cypher: |-
    MATCH (n:Computer {enabled: false})
    RETURN n.name AS n_name
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} is disabled
- group: general
  desc: List all disabled users who have not logged on in over 90 days (lastLogonTimestamp)
  cypher: |-
    WITH 90 as days_since_logon
    MATCH (u:User {enabled: false})
    WHERE u.lastlogontimestamp < (datetime().epochseconds - (days_since_logon * 86400))
      AND NOT u.lastlogontimestamp IN [-1.0, 0.0]
    RETURN u.name AS u_name, u.lastlogontimestamp AS u_lastlogontimestamp, days_since_logon
    ORDER BY u.name
  msg_template: |-
    Disabled user {{ u_name }} has not logged on in over {{ days_since_logon }} days
    (lastlogontimestamp={{ u_lastlogontimestamp }})
- group: general
  desc: List all Domain Admins
  cypher: |-
    MATCH (n:Group)
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-512"
    WITH n
    MATCH p=(n)<-[r:MemberOf*1..]-(m)
    RETURN m.name AS m_name
    ORDER BY m.name
  msg_template: |-
    User {{ m_name }} is MemberOf Domain Admins
- group: general
  desc: List all Domain Controllers
  cypher: |-
    MATCH (n:Group)
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-516"
    WITH n
    MATCH p=(n)<-[r:MemberOf*1..]-(m)
    RETURN m.name AS m_name
    ORDER BY m.name
  msg_template: |-
    Computer {{ m_name }} is a Domain Controller
- group: general
  desc: List all Domain Controllers OSs
  cypher: |-
    MATCH (n:Group)
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-516"
    WITH n
    MATCH p=(n)<-[r:MemberOf*1..]-(m)
    RETURN m.name AS m_name, m.operatingsystem AS m_operatingsystem
    ORDER BY m.name
  msg_template: |-
    Domain Controller {{ m_name }} OS {{ m_operatingsystem }}
- group: general
  desc: List all domain cross-domain DCSync privileges
  cypher: |-
    MATCH p=(n:Domain)-[r:DCSync|AllExtendedRights|GenericAll]->(m:Domain)
    WHERE n.name <> m.name
    RETURN n.name AS n_name, m.name AS m_name, type(r) AS rel_type
    ORDER BY n.name
  msg_template: |-
    Domain {{ n_name }} has {{ rel_type }} privileges for {{ m_name }}
- group: general
  desc: List all domain shortest paths to domains
  cypher: |-
    MATCH p=shortestPath((m:Domain)-[r*1..]->(n:Domain))
    WHERE NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag") AND NOT m=n
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all domain trusts
  cypher: |-
    MATCH (n:Domain)-[r:SameForestTrust|CrossForestTrust]->(m:Domain)
    RETURN n.name AS n_name, m.name AS m_name, type(r) AS rel_type
    ORDER BY n.name
  msg_template: |-
    Domain {{ n_name }} is trusted by {{ m_name }} via {{ rel_type }}
- group: general
  desc: List all domains
  cypher: |-
    MATCH (n:Domain)
    RETURN n.name AS n_name
    ORDER BY n.name
  msg_template: |-
    Domain {{ n_name }}
- group: general
  desc: List all Domains functional level
  cypher: |-
    MATCH (d:Domain)
    RETURN d.name AS d_name, d.functionallevel AS d_functionallevel
    ORDER BY d.name
  msg_template: |-
    Domain {{ d_name }} functional level {{ d_functionallevel }}
- group: general
  desc: List all DumpSMSAPassword privileges
  cypher: |-
    MATCH (n)-[r:DumpSMSAPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has DumpSMSAPassword over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all DumpSMSAPassword privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:DumpSMSAPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has DumpSMSAPassword over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all DumpSMSAPassword privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:DumpSMSAPassword]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has DumpSMSAPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all emails
  cypher: |-
    MATCH (u:User)
    RETURN u.name AS u_name, u.email AS u_email
    ORDER BY u.name
  msg_template: |-
    User {{ u_name }} email {{ u_email }}
- group: general
  desc: List all enabled computers
  cypher: |-
    MATCH (n:Computer {enabled: true})
    RETURN n.name AS n_name
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} is enabled
- group: general
  desc: List all Enterprise Admins
  cypher: |-
    MATCH (n:Group)
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-519"
    WITH n
    MATCH p=(n)<-[r:MemberOf*1..]-(m)
    RETURN m.name AS m_name
    ORDER BY m.name
  msg_template: |-
    User {{ m_name }} is MemberOf Enterprise Admins
- group: general
  desc: List all ExecuteDCOM privileges
  cypher: |-
    MATCH (n)-[r:ExecuteDCOM]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ExecuteDCOM over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ExecuteDCOM privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:ExecuteDCOM]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ExecuteDCOM over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all ExecuteDCOM privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:ExecuteDCOM]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ExecuteDCOM over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ForceChangePassword privileges
  cypher: |-
    MATCH (n)-[r:ForceChangePassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ForceChangePassword over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ForceChangePassword privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:ForceChangePassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ForceChangePassword over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ForceChangePassword privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:ForceChangePassword]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ForceChangePassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all GenericAll privileges
  cypher: |-
    MATCH (n)-[r:GenericAll]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has GenericAll over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all GenericAll privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:GenericAll]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has GenericAll over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all GenericAll privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:GenericAll]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has GenericAll over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all GenericWrite privileges
  cypher: |-
    MATCH (n)-[r:GenericWrite]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has GenericWrite over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all GenericWrite privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:GenericWrite]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has GenericWrite over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all GenericWrite privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:GenericWrite]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has GenericWrite over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all GoldenCert privileges
  cypher: |-
    MATCH (n)-[r:GoldenCert]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has GoldenCert over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all GoldenCert privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:GoldenCert]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has GoldenCert over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all GoldenCert privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:GoldenCert]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has GoldenCert over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all GP Links
  cypher: |-
    MATCH (g1)-[:GPLink]->(g2)
    RETURN g1.name AS g1_name, g2.name AS g2_name, labels(g2) AS labels_g2
    ORDER BY g1.name
  msg_template: |-
    GPO {{ g1_name }} is linked to {{ g2_name }} ({{ labels_g2[0] }}/{{ labels_g2[1] }})
- group: general
  desc: List all GPOAppliesTo privileges
  cypher: |-
    MATCH (n)-[r:GPOAppliesTo]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has GPOAppliesTo over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all GPOAppliesTo privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:GPOAppliesTo]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has GPOAppliesTo over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all GPOAppliesTo privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:GPOAppliesTo]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has GPOAppliesTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all GPOs
  cypher: |-
    MATCH (n:GPO)
    RETURN n.name AS n_name
    ORDER BY n.name
  msg_template: |-
    GPO {{ n_name }}
- group: general
  desc: List all group AbuseTGTDelegation privileges
  cypher: |-
    MATCH (n:Group)-[r:AbuseTGTDelegation]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AbuseTGTDelegation over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group ADCSESC1 privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC1]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC1 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group ADCSESC10a privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC10a]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC10a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group ADCSESC10b privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC10b]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC10b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group ADCSESC13 privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC13]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC13 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group ADCSESC3 privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC3]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC3 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group ADCSESC4 privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC4]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC4 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group ADCSESC6a privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC6a]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC6a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group ADCSESC6b privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC6b]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC6b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group ADCSESC9a privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC9a]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC9a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group ADCSESC9b privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC9b]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC9b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group AddAllowedToAct privileges
  cypher: |-
    MATCH (n:Group)-[r:AddAllowedToAct]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AddAllowedToAct over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group AddKeyCredentialLink privileges
  cypher: |-
    MATCH (n:Group)-[r:AddKeyCredentialLink]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AddKeyCredentialLink over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group AddMember privileges
  cypher: |-
    MATCH (n:Group)-[r:AddMember]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AddMember over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group AddSelf privileges
  cypher: |-
    MATCH (n:Group)-[r:AddSelf]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AddSelf over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group AdminTo privileges
  cypher: |-
    MATCH (n:Group)-[r:AdminTo]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AdminTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group AllExtendedRights privileges
  cypher: |-
    MATCH (n:Group)-[r:AllExtendedRights]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AllExtendedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group AllowedToAct privileges
  cypher: |-
    MATCH (n:Group)-[r:AllowedToAct]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} is AllowedToAct for {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group AllowedToDelegate privileges
  cypher: |-
    MATCH (n:Group)-[r:AllowedToDelegate]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AllowedToDelegate over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group CanApplyGPO privileges
  cypher: |-
    MATCH (n:Group)-[r:CanApplyGPO]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CanApplyGPO over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group CanPSRemote privileges
  cypher: |-
    MATCH (n:Group)-[r:CanPSRemote]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CanPSRemote over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group CanRDP privileges
  cypher: |-
    MATCH (n:Group)-[r:CanRDP]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CanRDP over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group CoerceAndRelayNTLMToADCS privileges
  cypher: |-
    MATCH (n:Group)-[r:CoerceAndRelayNTLMToADCS]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CoerceAndRelayNTLMToADCS over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all group CoerceAndRelayNTLMToLDAP privileges
  cypher: |-
    MATCH (n:Group)-[r:CoerceAndRelayNTLMToLDAP]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CoerceAndRelayNTLMToLDAP over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all group CoerceAndRelayNTLMToLDAPS privileges
  cypher: |-
    MATCH (n:Group)-[r:CoerceAndRelayNTLMToLDAPS]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CoerceAndRelayNTLMToLDAPS over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all group CoerceAndRelayNTLMToSMB privileges
  cypher: |-
    MATCH (n:Group)-[r:CoerceAndRelayNTLMToSMB]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CoerceAndRelayNTLMToSMB over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all group CoerceToTGT privileges
  cypher: |-
    MATCH (n:Group)-[r:CoerceToTGT]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CoerceToTGT over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group ContainsIdentity privileges
  cypher: |-
    MATCH (n:Group)-[r:ContainsIdentity]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ContainsIdentity over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group cross-domain DCSync privileges
  cypher: |-
    MATCH p=(n:Group)-[r:DCSync|AllExtendedRights|GenericAll]->(m:Domain)
    WHERE n.domain <> m.name
    RETURN n.name AS n_name, m.name AS m_name, type(r) AS rel_type
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has {{ rel_type }} privileges for {{ m_name }}
- group: general
  desc: List all group DCSync privileges
  cypher: |-
    MATCH (n:Group)-[r:DCSync|AllExtendedRights|GenericAll]->(m:Domain)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, type(r) AS rel_type
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has {{ rel_type }} over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group descriptions
  cypher: |-
    MATCH (g:Group)
    RETURN g.name AS g_name, g.description AS g_description
    ORDER BY g.name
  msg_template: |-
    Group {{ g_name }} description {{ g_description }}
- group: general
  desc: List all group DumpSMSAPassword privileges
  cypher: |-
    MATCH (n:Group)-[r:DumpSMSAPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has DumpSMSAPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group ExecuteDCOM privileges
  cypher: |-
    MATCH (n:Group)-[r:ExecuteDCOM]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ExecuteDCOM over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group ForceChangePassword privileges
  cypher: |-
    MATCH (n:Group)-[r:ForceChangePassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ForceChangePassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group GenericAll privileges
  cypher: |-
    MATCH (n:Group)-[r:GenericAll]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has GenericAll over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group GenericWrite privileges
  cypher: |-
    MATCH (n:Group)-[r:GenericWrite]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has GenericWrite over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group GoldenCert privileges
  cypher: |-
    MATCH (n:Group)-[r:GoldenCert]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has GoldenCert over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group GPOAppliesTo privileges
  cypher: |-
    MATCH (n:Group)-[r:GPOAppliesTo]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has GPOAppliesTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group group memberships
  cypher: |-
    MATCH (n:Group)-[r:MemberOf]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} is MemberOf {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group HasSession privileges
  cypher: |-
    MATCH (n:Group)-[r:HasSession]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has HasSession over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group HasSIDHistory privileges
  cypher: |-
    MATCH (n:Group)-[r:HasSIDHistory]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has HasSIDHistory over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group HasTrustKeys privileges
  cypher: |-
    MATCH (n:Group)-[r:HasTrustKeys]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has HasTrustKeys over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group memberships
  cypher: |-
    MATCH (n)-[r:MemberOf]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) is MemberOf {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all group memberships for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:MemberOf]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) is MemberOf {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all group memberships for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:MemberOf]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} is MemberOf {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group Owns privileges
  cypher: |-
    MATCH (n:Group)-[r:Owns]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} Owns {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group OwnsLimitedRights privileges
  cypher: |-
    MATCH (n:Group)-[r:OwnsLimitedRights]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has OwnsLimitedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group privileges
  cypher: |-
    MATCH (n:Group)-[r]->(m)
    RETURN n.name AS n_name, TYPE(r) AS rel_type, labels(m) AS labels_m, m.name AS m_name
    ORDER BY TYPE(r)
  msg_template: |-
    Group {{ n_name }} has {{ rel_type }} over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group PropagatesACEsTo privileges
  cypher: |-
    MATCH (n:Group)-[r:PropagatesACEsTo]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has PropagatesACEsTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group RDP privileges
  cypher: |-
    MATCH p=(g:Group)-[:CanRDP]->(c:Computer)
    RETURN g.name AS g_name, c.name AS c_name
    ORDER BY g.name
  msg_template: |-
    Group {{ g_name }} CanRDP to {{ c_name }}
- group: general
  desc: List all group ReadGMSAPassword privileges
  cypher: |-
    MATCH (n:Group)-[r:ReadGMSAPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ReadGMSAPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group ReadLAPSPassword privileges
  cypher: |-
    MATCH (n:Group)-[r:ReadLAPSPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ReadLAPSPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group shortest paths to admin groups
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)admin|adm).*" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all group shortest paths to Domain Admins
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-512" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all group shortest paths to Domain Controllers
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-516" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all group shortest paths to domains
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Domain))
    WHERE NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag") AND NOT m=n
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all group shortest paths to Enterprise Admins
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-519" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all group shortest paths to Exchange groups
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)EXCHANGE).*" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all group shortest paths to high-value targets
  cypher: |-
    MATCH (m:Group),(n {highvalue: true}),p=shortestPath((m)-[r*1..]->(n))
    WHERE NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag") AND NOT m=n
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all group shortest paths to service groups
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)service|svc).*" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all group shortest paths to SQL groups
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)SQL).*" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all group shortest paths to web groups
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)WEB).*" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all group SpoofSIDHistory privileges
  cypher: |-
    MATCH (n:Group)-[r:SpoofSIDHistory]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has SpoofSIDHistory over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group SQLAdmin privileges
  cypher: |-
    MATCH (n:Group)-[r:SQLAdmin]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has SQLAdmin over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group SyncedToEntraUser privileges
  cypher: |-
    MATCH (n:Group)-[r:SyncedToEntraUser]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has SyncedToEntraUser over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group SyncLAPSPassword privileges
  cypher: |-
    MATCH (n:Group)-[r:SyncLAPSPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has SyncLAPSPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group WriteAccountRestrictions privileges
  cypher: |-
    MATCH (n:Group)-[r:WriteAccountRestrictions]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteAccountRestrictions over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all group WriteDacl privileges
  cypher: |-
    MATCH (n:Group)-[r:WriteDacl]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteDacl over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group WriteGPLink privileges
  cypher: |-
    MATCH (n:Group)-[r:WriteGPLink]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteGPLink over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group WriteOwner privileges
  cypher: |-
    MATCH (n:Group)-[r:WriteOwner]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteOwner over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group WriteOwnerLimitedRights privileges
  cypher: |-
    MATCH (n:Group)-[r:WriteOwnerLimitedRights]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteOwnerLimitedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all group WriteSPN privileges
  cypher: |-
    MATCH (n:Group)-[r:WriteSPN]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteSPN over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group-delegated AdminTo privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[:MemberOf]->(g:Group)-[:AdminTo]->(m:Computer)
    RETURN n.name AS n_name, labels(n) AS labels_n, m.name AS m_name, g.name AS g_name
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) is MemberOf {{ g_name }} which is AdminTo {{
    m_name }}
- group: general
  desc: List all group-delegated AdminTo privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH p=(m:Group)-[:MemberOf]->(g:Group)-[:AdminTo]->(n:Computer)
    WHERE (m.objectid =~ "(?i)S-1-5-21-.*-513" OR m.objectid =~ "(?i).*-S-1-5-11" OR m.objectid =~ "(?i).*-S-1-1-0" OR m.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN m.name AS m_name, n.name AS n_name, g.name AS g_name
    ORDER BY m.name
  msg_template: |-
    Group {{ m_name }} is MemberOf {{ g_name }} which is AdminTo {{ n_name }}
- group: general
  desc: List all group-delegated privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[:MemberOf]->(g:Group),(g)-[r]->(m)
    RETURN n.name AS n_name, TYPE(r) AS rel_type, labels(m) AS labels_m, labels(n) AS labels_n, m.name AS m_name, g.name AS g_name
    ORDER BY TYPE(r)
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) is MemberOf {{ g_name }} which has {{ rel_type
    }} over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List all group-delegated privileges for this computer
  cypher: |-
    MATCH (n:Computer)-[:MemberOf]->(m:Group),(m)-[r]->(v)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, TYPE(r) AS rel_type, labels(v) AS labels_v, m.name AS m_name, v.name AS v_name
    ORDER BY m.name
  msg_template: |-
    Computer {{ n_name }} is MemberOf {{ m_name }} which has {{ rel_type }} over {{ v_name }} ({{
    labels_v[0] }}/{{ labels_v[1] }})
- group: group
  desc: List all group-delegated privileges for this group
  cypher: |-
    MATCH (n:Group)-[:MemberOf]->(m:Group),(m)-[r]->(v)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, TYPE(r) AS rel_type, labels(v) AS labels_v, m.name AS m_name, v.name AS v_name
    ORDER BY m.name
  msg_template: |-
    Group {{ n_name }} is MemberOf {{ m_name }} which has {{ rel_type }} over {{ v_name }} ({{
    labels_v[0] }}/{{ labels_v[1] }})
- group: user
  desc: List all group-delegated privileges for this user
  cypher: |-
    MATCH (n:User)-[:MemberOf]->(m:Group),(m)-[r]->(v)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, TYPE(r) AS rel_type, labels(v) AS labels_v, m.name AS m_name, v.name AS v_name
    ORDER BY m.name
  msg_template: |-
    User {{ n_name }} is MemberOf {{ m_name }} which has {{ rel_type }} over {{ v_name }} ({{ labels_v[0]
    }}/{{ labels_v[1] }})
- group: general
  desc: List all group-delegated privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[:MemberOf]->(g:Group)-[r]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, TYPE(r) AS rel_type, labels(m) AS labels_m, m.name AS m_name, g.name AS g_name
    ORDER BY TYPE(r)
  msg_template: |-
    Group {{ n_name }} is MemberOf {{ g_name }} which has {{ rel_type }} over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all group-delegated RDP privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[:MemberOf]->(g:Group)-[:CanRDP]->(m:Computer)
    RETURN n.name AS n_name, labels(n) AS labels_n, m.name AS m_name, g.name AS g_name
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) is MemberOf {{ g_name }} which CanRDP to {{
    m_name }}
- group: general
  desc: List all group-delegated RDP privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH p=(m:Group)-[:MemberOf]->(g:Group)-[:CanRDP]->(n:Computer)
    WHERE (m.objectid =~ "(?i)S-1-5-21-.*-513" OR m.objectid =~ "(?i).*-S-1-5-11" OR m.objectid =~ "(?i).*-S-1-1-0" OR m.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN m.name AS m_name, n.name AS n_name, g.name AS g_name
    ORDER BY m.name
  msg_template: |-
    Group {{ m_name }} is MemberOf {{ g_name }} which CanRDP to {{ n_name }}
- group: general
  desc: List all groups
  cypher: |-
    MATCH (n:Group)
    RETURN n.name AS n_name
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }}
- group: general
  desc: List all groups with an admin count
  cypher: |-
    MATCH (m:Group {admincount: true})
    RETURN m.name AS m_name
    ORDER BY m.name
  msg_template: |-
    Group {{ m_name }} has an admin count
- group: general
  desc: List all HasSession privileges
  cypher: |-
    MATCH (n)-[r:HasSession]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has HasSession over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all HasSession privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:HasSession]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has HasSession over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all HasSession privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:HasSession]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has HasSession over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all HasSIDHistory privileges
  cypher: |-
    MATCH (n)-[r:HasSIDHistory]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has HasSIDHistory over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all HasSIDHistory privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:HasSIDHistory]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has HasSIDHistory over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all HasSIDHistory privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:HasSIDHistory]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has HasSIDHistory over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all HasTrustKeys privileges
  cypher: |-
    MATCH (n)-[r:HasTrustKeys]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has HasTrustKeys over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all HasTrustKeys privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:HasTrustKeys]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has HasTrustKeys over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all HasTrustKeys privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:HasTrustKeys]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has HasTrustKeys over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all high-value computers
  cypher: |-
    MATCH (m:Computer {highvalue: true})
    RETURN m.name AS m_name
    ORDER BY m.name
  msg_template: |-
    Computer {{ m_name }} is high value
- group: general
  desc: List all high-value groups
  cypher: |-
    MATCH (m:Group {highvalue: true})
    RETURN m.name AS m_name
    ORDER BY m.name
  msg_template: |-
    Group {{ m_name }} is high value
- group: general
  desc: List all high-value owned principals
  cypher: |-
    MATCH (m {highvalue: true, owned: true})
    RETURN m.name AS m_name, labels(m) AS labels_m
    ORDER BY m.name
  msg_template: |-
    {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }}) is high value
- group: general
  desc: List all high-value principals
  cypher: |-
    MATCH p=(n {highvalue: true})
    RETURN n.name AS n_name, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) is high value
- group: general
  desc: List all high-value users
  cypher: |-
    MATCH (m:User {highvalue: true})
    RETURN m.name AS m_name
    ORDER BY m.name
  msg_template: |-
    User {{ m_name }} is high value
- group: general
  desc: List all kerberoastable users
  cypher: |-
    MATCH (n:User {hasspn: true})
    RETURN n.name AS result
    ORDER BY n.name
  msg_template: |-
    User {{ result }} is kerberoastable
- group: general
  desc: List all kerberoastable users for owned principals
  cypher: |-
    MATCH (n:User {owned: true, hasspn: true})
    RETURN n.name AS result
    ORDER BY n.name
  msg_template: |-
    User {{ result }} is kerberoastable
- group: general
  desc: List all members of high-value groups
  cypher: |-
    MATCH p=(n:User)-[r:MemberOf*1..]->(m:Group {highvalue: true})
    RETURN n.name AS n_name, m.name AS m_name
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} is MemberOf high value group {{ m_name }}
- group: general
  desc: List all members of high-value groups for owned principals
  cypher: |-
    MATCH p=(n {owned: true})-[r:MemberOf*1..]->(m:Group {highvalue: true})
    RETURN n.name AS n_name, m.name AS m_name, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) is MemberOf high value group {{ m_name }}
- group: general
  desc: List all object control over Containers
  cypher: |-
    MATCH (n)-[r:Owns|AllExtendedRights|WriteDacl|GenericAll|WriteOwner|GenericWrite]->(c:Container)
    RETURN n.name AS n_name, c.name AS c_name, TYPE(r) AS rel_type, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    ({{ labels_n[0] }}/{{ labels_n[1] }}) {{ n_name }} has {{ rel_type }} over Container {{ c_name }}
- group: general
  desc: List all object control over Containers for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:Owns|AllExtendedRights|WriteDacl|GenericAll|WriteOwner|GenericWrite]->(c:Container)
    RETURN n.name AS n_name, c.name AS c_name, TYPE(r) AS rel_type, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    ({{ labels_n[0] }}/{{ labels_n[1] }}) {{ n_name }} has {{ rel_type }} over Container {{ c_name }}
- group: general
  desc: List all object control over GPOs
  cypher: |-
    MATCH (n)-[r:Owns|AllExtendedRights|WriteDacl|GenericAll|WriteOwner|GenericWrite]->(g:GPO)
    RETURN n.name AS n_name, g.name AS g_name, TYPE(r) AS rel_type, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    ({{ labels_n[0] }}/{{ labels_n[1] }}) {{ n_name }} has {{ rel_type }} over GPO {{ g_name }}
- group: general
  desc: List all object control over GPOs for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:Owns|AllExtendedRights|WriteDacl|GenericAll|WriteOwner|GenericWrite]->(g:GPO)
    RETURN n.name AS n_name, g.name AS g_name, TYPE(r) AS rel_type, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    ({{ labels_n[0] }}/{{ labels_n[1] }}) {{ n_name }} has {{ rel_type }} over GPO {{ g_name }}
- group: general
  desc: List all object control over OUs
  cypher: |-
    MATCH (n)-[r:Owns|AllExtendedRights|WriteDacl|GenericAll|WriteOwner|GenericWrite]->(o:OU)
    RETURN n.name AS n_name, o.name AS o_name, TYPE(r) AS rel_type, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    ({{ labels_n[0] }}/{{ labels_n[1] }}) {{ n_name }} has {{ rel_type }} over OU {{ o_name }}
- group: general
  desc: List all object control over OUs for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:Owns|AllExtendedRights|WriteDacl|GenericAll|WriteOwner|GenericWrite]->(o:OU)
    RETURN n.name AS n_name, o.name AS o_name, TYPE(r) AS rel_type, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    ({{ labels_n[0] }}/{{ labels_n[1] }}) {{ n_name }} has {{ rel_type }} over OU {{ o_name }}
- group: general
  desc: List all OUs
  cypher: |-
    MATCH (o:OU)
    RETURN o.name AS o_name
    ORDER BY o.name
  msg_template: |-
    OU {{ o_name }}
- group: general
  desc: List all owned principals
  cypher: |-
    MATCH (m {owned: true})
    RETURN m.name AS m_name, labels(m) AS labels_m
    ORDER BY m.name
  msg_template: |-
    Owned principal {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all owned principals with an admin count
  cypher: |-
    MATCH (m {admincount: true, owned: true})
    RETURN labels(m) AS labels_m, m.name AS m_name
    ORDER BY m.name
  msg_template: |-
    {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }}) has an admin count
- group: general
  desc: List all Owns privileges
  cypher: |-
    MATCH (n)-[r:Owns]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has Owns over {{ m_name }} ({{ labels_m[0] }}/{{
    labels_m[1] }})
- group: general
  desc: List all Owns privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:Owns]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has Owns over {{ m_name }} ({{ labels_m[0] }}/{{
    labels_m[1] }})
- group: general
  desc: List all Owns privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:Owns]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has Owns over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all OwnsLimitedRights privileges
  cypher: |-
    MATCH (n)-[r:OwnsLimitedRights]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has OwnsLimitedRights over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all OwnsLimitedRights privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:OwnsLimitedRights]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has OwnsLimitedRights over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all OwnsLimitedRights privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:OwnsLimitedRights]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has OwnsLimitedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r]->(m)
    RETURN n.name AS n_name, TYPE(r) AS rel_type, labels(m) AS labels_m, labels(n) AS labels_n, m.name AS m_name
    ORDER BY TYPE(r)
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has {{ rel_type }} over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List all privileges for this computer
  cypher: |-
    MATCH (n:Computer)-[r]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, TYPE(r) AS rel_type, labels(m) AS labels_m, m.name AS m_name
    ORDER BY TYPE(r)
  msg_template: |-
    Computer {{ n_name }} has {{ rel_type }} over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List all privileges for this group
  cypher: |-
    MATCH (n:Group)-[r]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, TYPE(r) AS rel_type, labels(m) AS labels_m, m.name AS m_name
    ORDER BY TYPE(r)
  msg_template: |-
    Group {{ n_name }} has {{ rel_type }} over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List all privileges for this user
  cypher: |-
    MATCH (n:User)-[r]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, TYPE(r) AS rel_type, labels(m) AS labels_m, m.name AS m_name
    ORDER BY TYPE(r)
  msg_template: |-
    User {{ n_name }} has {{ rel_type }} over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, TYPE(r) AS rel_type, labels(m) AS labels_m, m.name AS m_name
    ORDER BY TYPE(r)
  msg_template: |-
    Group {{ n_name }} has {{ rel_type }} over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all PropagatesACEsTo privileges
  cypher: |-
    MATCH (n)-[r:PropagatesACEsTo]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has PropagatesACEsTo over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all PropagatesACEsTo privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:PropagatesACEsTo]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has PropagatesACEsTo over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all PropagatesACEsTo privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:PropagatesACEsTo]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has PropagatesACEsTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all RDP privileges for owned principals
  cypher: |-
    MATCH p=(m {owned: true})-[:CanRDP]->(c:Computer)
    RETURN m.name AS m_name, c.name AS c_name, labels(m) AS labels_m
    ORDER BY m.name
  msg_template: |-
    {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }}) CanRDP to {{ c_name }}
- group: general
  desc: List all RDP privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH p=(g:Group)-[:CanRDP]->(c:Computer)
    WHERE (g.objectid =~ "(?i)S-1-5-21-.*-513" OR g.objectid =~ "(?i).*-S-1-5-11" OR g.objectid =~ "(?i).*-S-1-1-0" OR g.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN g.name AS g_name, c.name AS c_name
    ORDER BY g.name
  msg_template: |-
    Group {{ g_name }} CanRDP to {{ c_name }}
- group: general
  desc: List all ReadGMSAPassword privileges
  cypher: |-
    MATCH (n)-[r:ReadGMSAPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ReadGMSAPassword over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ReadGMSAPassword privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:ReadGMSAPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ReadGMSAPassword over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ReadGMSAPassword privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:ReadGMSAPassword]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ReadGMSAPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ReadLAPSPassword privileges
  cypher: |-
    MATCH (n)-[r:ReadLAPSPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ReadLAPSPassword over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ReadLAPSPassword privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:ReadLAPSPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has ReadLAPSPassword over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all ReadLAPSPassword privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:ReadLAPSPassword]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ReadLAPSPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all SameForestTrust privileges
  cypher: |-
    MATCH (n)-[r:SameForestTrust]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has SameForestTrust over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all SameForestTrust privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:SameForestTrust]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has SameForestTrust over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all sensitive users
  cypher: |-
    MATCH (m:User {sensitive: true})
    RETURN m.name AS m_name
    ORDER BY m.name
  msg_template: |-
    User {{ m_name }} is sensitive
- group: general
  desc: List all sessions
  cypher: |-
    MATCH p=(m:Computer)-[r:HasSession]->(n:User)
    RETURN n.name AS n_name, m.name AS m_name
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} HasSession on {{ m_name }}
- group: general
  desc: List all sessions for owned principals
  cypher: |-
    MATCH p=(m:Computer)-[r:HasSession]->(n:User {owned: true})
    RETURN n.name AS n_name, m.name AS m_name
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} HasSession on {{ m_name }}
- group: general
  desc: List all shortest paths to admin groups for owned principals
  cypher: |-
    MATCH p=shortestPath((m {owned: true})-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)admin|adm).*" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: computer
  desc: List all shortest paths to admin groups for this computer
  cypher: |-
    MATCH p=shortestPath((m:Computer)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)admin|adm).*" AND m.name =~ '((?i){{ params.computer }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: group
  desc: List all shortest paths to admin groups for this group
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)admin|adm).*" AND NOT m=n AND m.name =~ '((?i){{ params.group }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: user
  desc: List all shortest paths to admin groups for this user
  cypher: |-
    MATCH p=shortestPath((m:User)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)admin|adm).*" AND m.name =~ '((?i){{ params.user }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to admin groups for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE (m.objectid =~ "(?i)S-1-5-21-.*-513" OR m.objectid =~ "(?i).*-S-1-5-11" OR m.objectid =~ "(?i).*-S-1-1-0" OR m.objectid =~ "(?i).*-S-1-5-32-545") AND n.name =~ ".*((?i)admin|adm).*" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to Domain Admins for owned principals
  cypher: |-
    MATCH p=shortestPath((m {owned: true})-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-512" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: computer
  desc: List all shortest paths to Domain Admins for this computer
  cypher: |-
    MATCH p=shortestPath((m:Computer)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-512" AND m.name =~ '((?i){{ params.computer }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: group
  desc: List all shortest paths to Domain Admins for this group
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-512" AND NOT m=n AND m.name =~ '((?i){{ params.group }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: user
  desc: List all shortest paths to Domain Admins for this user
  cypher: |-
    MATCH p=shortestPath((m:User)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-512" AND m.name =~ '((?i){{ params.user }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to Domain Admins for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE (m.objectid =~ "(?i)S-1-5-21-.*-513" OR m.objectid =~ "(?i).*-S-1-5-11" OR m.objectid =~ "(?i).*-S-1-1-0" OR m.objectid =~ "(?i).*-S-1-5-32-545") AND n.objectid =~ "(?i)S-1-5-21-.*-512" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to Domain Controllers for owned principals
  cypher: |-
    MATCH p=shortestPath((m {owned: true})-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-516" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: computer
  desc: List all shortest paths to Domain Controllers for this computer
  cypher: |-
    MATCH p=shortestPath((m:Computer)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-516" AND m.name =~ '((?i){{ params.computer }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: group
  desc: List all shortest paths to Domain Controllers for this group
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-516" AND NOT m=n AND m.name =~ '((?i){{ params.group }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: user
  desc: List all shortest paths to Domain Controllers for this user
  cypher: |-
    MATCH p=shortestPath((m:User)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-516" AND m.name =~ '((?i){{ params.user }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to Domain Controllers for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE (m.objectid =~ "(?i)S-1-5-21-.*-513" OR m.objectid =~ "(?i).*-S-1-5-11" OR m.objectid =~ "(?i).*-S-1-1-0" OR m.objectid =~ "(?i).*-S-1-5-32-545") AND n.objectid =~ "(?i)S-1-5-21-.*-516" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to domains for owned principals
  cypher: |-
    MATCH p=shortestPath((m {owned: true})-[r*1..]->(n:Domain))
    WHERE NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag") AND NOT m=n
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to domains for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Domain))
    WHERE (m.objectid =~ "(?i)S-1-5-21-.*-513" OR m.objectid =~ "(?i).*-S-1-5-11" OR m.objectid =~ "(?i).*-S-1-1-0" OR m.objectid =~ "(?i).*-S-1-5-32-545") AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag") AND NOT m=n
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to Enterprise Admins for owned principals
  cypher: |-
    MATCH p=shortestPath((m {owned: true})-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-519" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: computer
  desc: List all shortest paths to Enterprise Admins for this computer
  cypher: |-
    MATCH p=shortestPath((m:Computer)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-519" AND m.name =~ '((?i){{ params.computer }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: group
  desc: List all shortest paths to Enterprise Admins for this group
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-519" AND NOT m=n AND m.name =~ '((?i){{ params.group }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: user
  desc: List all shortest paths to Enterprise Admins for this user
  cypher: |-
    MATCH p=shortestPath((m:User)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-519" AND m.name =~ '((?i){{ params.user }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to Enterprise Admins for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE (m.objectid =~ "(?i)S-1-5-21-.*-513" OR m.objectid =~ "(?i).*-S-1-5-11" OR m.objectid =~ "(?i).*-S-1-1-0" OR m.objectid =~ "(?i).*-S-1-5-32-545") AND n.objectid =~ "(?i)S-1-5-21-.*-519" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to Exchange groups for owned principals
  cypher: |-
    MATCH p=shortestPath((m {owned: true})-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)EXCHANGE).*" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag") AND NOT m=n
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: computer
  desc: List all shortest paths to Exchange groups for this computer
  cypher: |-
    MATCH p=shortestPath((m:Computer)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)EXCHANGE).*" AND m.name =~ '((?i){{ params.computer }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: group
  desc: List all shortest paths to Exchange groups for this group
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)EXCHANGE).*" AND NOT m=n AND m.name =~ '((?i){{ params.group }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: user
  desc: List all shortest paths to Exchange groups for this user
  cypher: |-
    MATCH p=shortestPath((m:User)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)EXCHANGE).*" AND m.name =~ '((?i){{ params.user }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to Exchange groups for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE (m.objectid =~ "(?i)S-1-5-21-.*-513" OR m.objectid =~ "(?i).*-S-1-5-11" OR m.objectid =~ "(?i).*-S-1-1-0" OR m.objectid =~ "(?i).*-S-1-5-32-545") AND n.name =~ ".*((?i)EXCHANGE).*" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag") AND NOT m=n
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to high-value targets for owned principals
  cypher: |-
    MATCH (m {owned: true}),(n {highvalue: true}),p=shortestPath((m)-[r*1..]->(n))
    WHERE NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag") AND NOT m=n
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: computer
  desc: List all shortest paths to high-value targets for this computer
  cypher: |-
    MATCH (m:Computer),(n {highvalue: true}),p=shortestPath((m)-[r*1..]->(n))
    WHERE NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag") AND NOT m=n AND m.name =~ '((?i){{ params.computer }})'
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: group
  desc: List all shortest paths to high-value targets for this group
  cypher: |-
    MATCH (m:Group),(n {highvalue: true}),p=shortestPath((m)-[r*1..]->(n))
    WHERE NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag") AND NOT m=n AND m.name =~ '((?i){{ params.group }})'
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: user
  desc: List all shortest paths to high-value targets for this user
  cypher: |-
    MATCH (m:User),(n {highvalue: true}),p=shortestPath((m)-[r*1..]->(n))
    WHERE NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag") AND NOT m=n AND m.name =~ '((?i){{ params.user }})'
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to high-value targets for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (m:Group),(n {highvalue: true}),p=shortestPath((m)-[r*1..]->(n))
    WHERE (m.objectid =~ "(?i)S-1-5-21-.*-513" OR m.objectid =~ "(?i).*-S-1-5-11" OR m.objectid =~ "(?i).*-S-1-1-0" OR m.objectid =~ "(?i).*-S-1-5-32-545") AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag") AND NOT m=n
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to service groups for owned principals
  cypher: |-
    MATCH p=shortestPath((m {owned: true})-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)service|svc).*" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: computer
  desc: List all shortest paths to service groups for this computer
  cypher: |-
    MATCH p=shortestPath((m:Computer)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)service|svc).*" AND m.name =~ '((?i){{ params.computer }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: group
  desc: List all shortest paths to service groups for this group
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)service|svc).*" AND NOT m=n AND m.name =~ '((?i){{ params.group }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: user
  desc: List all shortest paths to service groups for this user
  cypher: |-
    MATCH p=shortestPath((m:User)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)service|svc).*" AND m.name =~ '((?i){{ params.user }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to service groups for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE (m.objectid =~ "(?i)S-1-5-21-.*-513" OR m.objectid =~ "(?i).*-S-1-5-11" OR m.objectid =~ "(?i).*-S-1-1-0" OR m.objectid =~ "(?i).*-S-1-5-32-545") AND n.name =~ ".*((?i)service|svc).*" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to SQL groups for owned principals
  cypher: |-
    MATCH p=shortestPath((m {owned: true})-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)SQL).*" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: computer
  desc: List all shortest paths to sql groups for this computer
  cypher: |-
    MATCH p=shortestPath((m:Computer)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)SQL).*" AND m.name =~ '((?i){{ params.computer }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: group
  desc: List all shortest paths to sql groups for this group
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)SQL).*" AND NOT m=n AND m.name =~ '((?i){{ params.group }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: user
  desc: List all shortest paths to sql groups for this user
  cypher: |-
    MATCH p=shortestPath((m:User)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)SQL).*" AND m.name =~ '((?i){{ params.user }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to SQL groups for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE (m.objectid =~ "(?i)S-1-5-21-.*-513" OR m.objectid =~ "(?i).*-S-1-5-11" OR m.objectid =~ "(?i).*-S-1-1-0" OR m.objectid =~ "(?i).*-S-1-5-32-545") AND n.name =~ ".*((?i)SQL).*" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: computer
  desc: List all shortest paths to this computer
  cypher: |-
    MATCH p=shortestPath((m)-[r*1..]->(n:Computer))
    WHERE n.name =~ '((?i){{ params.computer }})' AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: computer
  desc: List all shortest paths to this computer for owned principals
  cypher: |-
    MATCH p=shortestPath((m {owned: true})-[r*1..]->(n:Computer))
    WHERE n.name =~ '((?i){{ params.computer }})' AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: computer
  desc: List all shortest paths to this computer for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Computer))
    WHERE (m.objectid =~ "(?i)S-1-5-21-.*-513" OR m.objectid =~ "(?i).*-S-1-5-11" OR m.objectid =~ "(?i).*-S-1-1-0" OR m.objectid =~ "(?i).*-S-1-5-32-545") AND n.name =~ '((?i){{ params.computer }})' AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: group
  desc: List all shortest paths to this group
  cypher: |-
    MATCH p=shortestPath((m)-[r*1..]->(n:Group))
    WHERE n.name =~ '((?i){{ params.group }})' AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: group
  desc: List all shortest paths to this group for owned principals
  cypher: |-
    MATCH p=shortestPath((m {owned: true})-[r*1..]->(n:Group))
    WHERE n.name =~ '((?i){{ params.group }})' AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: group
  desc: List all shortest paths to this group for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE (m.objectid =~ "(?i)S-1-5-21-.*-513" OR m.objectid =~ "(?i).*-S-1-5-11" OR m.objectid =~ "(?i).*-S-1-1-0" OR m.objectid =~ "(?i).*-S-1-5-32-545") AND n.name =~ '((?i){{ params.group }})' AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: user
  desc: List all shortest paths to this user
  cypher: |-
    MATCH p=shortestPath((m)-[r*1..]->(n:User))
    WHERE n.name =~ '((?i){{ params.user }})' AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: user
  desc: List all shortest paths to this user for owned principals
  cypher: |-
    MATCH p=shortestPath((m {owned: true})-[r*1..]->(n:User))
    WHERE n.name =~ '((?i){{ params.user }})' AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: user
  desc: List all shortest paths to this user for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:User))
    WHERE (m.objectid =~ "(?i)S-1-5-21-.*-513" OR m.objectid =~ "(?i).*-S-1-5-11" OR m.objectid =~ "(?i).*-S-1-1-0" OR m.objectid =~ "(?i).*-S-1-5-32-545") AND n.name =~ '((?i){{ params.user }})' AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to web groups for owned principals
  cypher: |-
    MATCH p=shortestPath((m {owned: true})-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)WEB).*" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: computer
  desc: List all shortest paths to web groups for this computer
  cypher: |-
    MATCH p=shortestPath((m:Computer)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)WEB).*" AND m.name =~ '((?i){{ params.computer }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: group
  desc: List all shortest paths to web groups for this group
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)WEB).*" AND NOT m=n AND m.name =~ '((?i){{ params.group }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: user
  desc: List all shortest paths to web groups for this user
  cypher: |-
    MATCH p=shortestPath((m:User)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)WEB).*" AND m.name =~ '((?i){{ params.user }})' AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all shortest paths to web groups for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH p=shortestPath((m:Group)-[r*1..]->(n:Group))
    WHERE (m.objectid =~ "(?i)S-1-5-21-.*-513" OR m.objectid =~ "(?i).*-S-1-5-11" OR m.objectid =~ "(?i).*-S-1-1-0" OR m.objectid =~ "(?i).*-S-1-5-32-545") AND n.name =~ ".*((?i)WEB).*" AND NOT m=n AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all SpoofSIDHistory privileges
  cypher: |-
    MATCH (n)-[r:SpoofSIDHistory]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has SpoofSIDHistory over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all SpoofSIDHistory privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:SpoofSIDHistory]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has SpoofSIDHistory over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all SpoofSIDHistory privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:SpoofSIDHistory]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has SpoofSIDHistory over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all SQLAdmin privileges
  cypher: |-
    MATCH (n)-[r:SQLAdmin]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has SQLAdmin over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all SQLAdmin privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:SQLAdmin]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has SQLAdmin over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all SQLAdmin privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:SQLAdmin]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has SQLAdmin over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all SyncedToEntraUser privileges
  cypher: |-
    MATCH (n)-[r:SyncedToEntraUser]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has SyncedToEntraUser over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all SyncedToEntraUser privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:SyncedToEntraUser]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has SyncedToEntraUser over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all SyncedToEntraUser privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:SyncedToEntraUser]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has SyncedToEntraUser over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all SyncLAPSPassword privileges
  cypher: |-
    MATCH (n)-[r:SyncLAPSPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has SyncLAPSPassword over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all SyncLAPSPassword privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:SyncLAPSPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has SyncLAPSPassword over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all SyncLAPSPassword privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:SyncLAPSPassword]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has SyncLAPSPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all unsupported OSs
  cypher: |-
    MATCH (H:Computer)
    WHERE H.operatingsystem =~ '.*(2000|2003|2008|xp|vista|7|me).*'
    RETURN H.name AS H_name, H.operatingsystem AS H_operatingsystem
    ORDER BY H.name
  msg_template: |-
    Computer {{ H_name }} is unsupported with OS {{ H_operatingsystem }}
- group: general
  desc: List all user AbuseTGTDelegation privileges
  cypher: |-
    MATCH (n:User)-[r:AbuseTGTDelegation]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has AbuseTGTDelegation over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user ADCSESC1 privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC1]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC1 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user ADCSESC10a privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC10a]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC10a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user ADCSESC10b privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC10b]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC10b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user ADCSESC13 privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC13]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC13 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user ADCSESC3 privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC3]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC3 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user ADCSESC4 privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC4]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC4 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user ADCSESC6a privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC6a]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC6a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user ADCSESC6b privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC6b]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC6b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user ADCSESC9a privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC9a]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC9a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user ADCSESC9b privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC9b]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC9b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user AddAllowedToAct privileges
  cypher: |-
    MATCH (n:User)-[r:AddAllowedToAct]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has AddAllowedToAct over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user AddKeyCredentialLink privileges
  cypher: |-
    MATCH (n:User)-[r:AddKeyCredentialLink]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has AddKeyCredentialLink over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user AddMember privileges
  cypher: |-
    MATCH (n:User)-[r:AddMember]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has AddMember over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user AddSelf privileges
  cypher: |-
    MATCH (n:User)-[r:AddSelf]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has AddSelf over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user AdminTo privileges
  cypher: |-
    MATCH (n:User)-[r:AdminTo]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has AdminTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user AllExtendedRights privileges
  cypher: |-
    MATCH (n:User)-[r:AllExtendedRights]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has AllExtendedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user AllowedToAct privileges
  cypher: |-
    MATCH (n:User)-[r:AllowedToAct]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} is AllowedToAct for {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user AllowedToDelegate privileges
  cypher: |-
    MATCH (n:User)-[r:AllowedToDelegate]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has AllowedToDelegate over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user CanApplyGPO privileges
  cypher: |-
    MATCH (n:User)-[r:CanApplyGPO]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has CanApplyGPO over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user CanPSRemote privileges
  cypher: |-
    MATCH (n:User)-[r:CanPSRemote]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has CanPSRemote over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user CanRDP privileges
  cypher: |-
    MATCH (n:User)-[r:CanRDP]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has CanRDP over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user CoerceAndRelayNTLMToADCS privileges
  cypher: |-
    MATCH (n:User)-[r:CoerceAndRelayNTLMToADCS]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has CoerceAndRelayNTLMToADCS over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all user CoerceAndRelayNTLMToLDAP privileges
  cypher: |-
    MATCH (n:User)-[r:CoerceAndRelayNTLMToLDAP]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has CoerceAndRelayNTLMToLDAP over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all user CoerceAndRelayNTLMToLDAPS privileges
  cypher: |-
    MATCH (n:User)-[r:CoerceAndRelayNTLMToLDAPS]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has CoerceAndRelayNTLMToLDAPS over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all user CoerceAndRelayNTLMToSMB privileges
  cypher: |-
    MATCH (n:User)-[r:CoerceAndRelayNTLMToSMB]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has CoerceAndRelayNTLMToSMB over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all user CoerceToTGT privileges
  cypher: |-
    MATCH (n:User)-[r:CoerceToTGT]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has CoerceToTGT over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user ContainsIdentity privileges
  cypher: |-
    MATCH (n:User)-[r:ContainsIdentity]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ContainsIdentity over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user cross-domain DCSync privileges
  cypher: |-
    MATCH p=(n:User)-[r:DCSync|AllExtendedRights|GenericAll]->(m:Domain)
    WHERE n.domain <> m.name
    RETURN n.name AS n_name, m.name AS m_name, type(r) AS rel_type
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has {{ rel_type }} privileges for {{ m_name }}
- group: general
  desc: List all user DCSync privileges
  cypher: |-
    MATCH (n:User)-[r:DCSync|AllExtendedRights|GenericAll]->(m:Domain)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, type(r) AS rel_type
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has {{ rel_type }} over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user descriptions
  cypher: |-
    MATCH (u:User)
    RETURN u.name AS u_name, u.description AS u_description
    ORDER BY u.name
  msg_template: |-
    User {{ u_name }} description {{ u_description }}
- group: general
  desc: List all user DumpSMSAPassword privileges
  cypher: |-
    MATCH (n:User)-[r:DumpSMSAPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has DumpSMSAPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user ExecuteDCOM privileges
  cypher: |-
    MATCH (n:User)-[r:ExecuteDCOM]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ExecuteDCOM over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user ForceChangePassword privileges
  cypher: |-
    MATCH (n:User)-[r:ForceChangePassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ForceChangePassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user GenericAll privileges
  cypher: |-
    MATCH (n:User)-[r:GenericAll]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has GenericAll over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user GenericWrite privileges
  cypher: |-
    MATCH (n:User)-[r:GenericWrite]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has GenericWrite over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user GoldenCert privileges
  cypher: |-
    MATCH (n:User)-[r:GoldenCert]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has GoldenCert over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user GPOAppliesTo privileges
  cypher: |-
    MATCH (n:User)-[r:GPOAppliesTo]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has GPOAppliesTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user group memberships
  cypher: |-
    MATCH (n:User)-[r:MemberOf]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} is MemberOf {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user HasSession privileges
  cypher: |-
    MATCH (n:User)-[r:HasSession]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has HasSession over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user HasSIDHistory privileges
  cypher: |-
    MATCH (n:User)-[r:HasSIDHistory]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has HasSIDHistory over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user HasTrustKeys privileges
  cypher: |-
    MATCH (n:User)-[r:HasTrustKeys]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has HasTrustKeys over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user Owns privileges
  cypher: |-
    MATCH (n:User)-[r:Owns]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} Owns {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user OwnsLimitedRights privileges
  cypher: |-
    MATCH (n:User)-[r:OwnsLimitedRights]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has OwnsLimitedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user privileges
  cypher: |-
    MATCH (n:User)-[r]->(m)
    RETURN n.name AS n_name, TYPE(r) AS rel_type, labels(m) AS labels_m, m.name AS m_name
    ORDER BY TYPE(r)
  msg_template: |-
    User {{ n_name }} has {{ rel_type }} over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user PropagatesACEsTo privileges
  cypher: |-
    MATCH (n:User)-[r:PropagatesACEsTo]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has PropagatesACEsTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user RDP privileges
  cypher: |-
    MATCH p=(u:User)-[:CanRDP]->(c:Computer)
    RETURN u.name AS u_name, c.name AS c_name
    ORDER BY u.name
  msg_template: |-
    User {{ u_name }} CanRDP to {{ c_name }}
- group: general
  desc: List all user ReadGMSAPassword privileges
  cypher: |-
    MATCH (n:User)-[r:ReadGMSAPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ReadGMSAPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user ReadLAPSPassword privileges
  cypher: |-
    MATCH (n:User)-[r:ReadLAPSPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ReadLAPSPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user shortest paths to admin groups
  cypher: |-
    MATCH p=shortestPath((m:User)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)admin|adm).*" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all user shortest paths to Domain Admins
  cypher: |-
    MATCH p=shortestPath((m:User)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-512" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all user shortest paths to Domain Controllers
  cypher: |-
    MATCH p=shortestPath((m:User)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-516" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all user shortest paths to domains
  cypher: |-
    MATCH p=shortestPath((m:User)-[r*1..]->(n:Domain))
    WHERE NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag") AND NOT m=n
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all user shortest paths to Enterprise Admins
  cypher: |-
    MATCH p=shortestPath((m:User)-[r*1..]->(n:Group))
    WHERE n.objectid =~ "(?i)S-1-5-21-.*-519" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all user shortest paths to Exchange groups
  cypher: |-
    MATCH p=shortestPath((m:User)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)EXCHANGE).*" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all user shortest paths to high-value targets
  cypher: |-
    MATCH (m:User),(n {highvalue: true}),p=shortestPath((m)-[r*1..]->(n))
    WHERE NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag") AND NOT m=n
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all user shortest paths to service groups
  cypher: |-
    MATCH p=shortestPath((m:User)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)service|svc).*" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all user shortest paths to SQL groups
  cypher: |-
    MATCH p=shortestPath((m:User)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)SQL).*" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all user shortest paths to web groups
  cypher: |-
    MATCH p=shortestPath((m:User)-[r*1..]->(n:Group))
    WHERE n.name =~ ".*((?i)WEB).*" AND NONE(x IN relationships(p)
    WHERE type(x)="Contains") AND NONE(x IN relationships(p)
    WHERE type(x)="CrossForestTrust") AND NONE(x IN relationships(p)
    WHERE type(x)="DelegatedEnrollmentAgent") AND NONE(x IN relationships(p)
    WHERE type(x)="Enroll") AND NONE(x IN relationships(p)
    WHERE type(x)="EnrollOnBehalfOf") AND NONE(x IN relationships(p)
    WHERE type(x)="EnterpriseCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="ExtendedByPolicy") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChanges") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesAll") AND NONE(x IN relationships(p)
    WHERE type(x)="GetChangesInFilteredSet") AND NONE(x IN relationships(p)
    WHERE type(x)="GPLink") AND NONE(x IN relationships(p)
    WHERE type(x)="HostsCAService") AND NONE(x IN relationships(p)
    WHERE type(x)="IssuedSignedBy") AND NONE(x IN relationships(p)
    WHERE type(x)="LocalToComputer") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCA") AND NONE(x IN relationships(p)
    WHERE type(x)="ManageCertificates") AND NONE(x IN relationships(p)
    WHERE type(x)="MemberOfLocalGroup") AND NONE(x IN relationships(p)
    WHERE type(x)="NTAuthStoreFor") AND NONE(x IN relationships(p)
    WHERE type(x)="OIDGroupLink") AND NONE(x IN relationships(p)
    WHERE type(x)="OwnsRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="PublishedTo") AND NONE(x IN relationships(p)
    WHERE type(x)="RemoteInteractiveLogonPrivilege") AND NONE(x IN relationships(p)
    WHERE type(x)="RootCAFor") AND NONE(x IN relationships(p)
    WHERE type(x)="TrustedForNTAuth") AND NONE(x IN relationships(p)
    WHERE type(x)="WriteOwnerRaw") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKIEnrollmentFlag") AND NONE(x IN relationships(p)
    WHERE type(x)="WritePKINameFlag")
    RETURN m.name AS m_name, p
    ORDER BY m.name
  msg_template: null
- group: general
  desc: List all user SpoofSIDHistory privileges
  cypher: |-
    MATCH (n:User)-[r:SpoofSIDHistory]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has SpoofSIDHistory over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user SQLAdmin privileges
  cypher: |-
    MATCH (n:User)-[r:SQLAdmin]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has SQLAdmin over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user SyncedToEntraUser privileges
  cypher: |-
    MATCH (n:User)-[r:SyncedToEntraUser]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has SyncedToEntraUser over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user SyncLAPSPassword privileges
  cypher: |-
    MATCH (n:User)-[r:SyncLAPSPassword]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has SyncLAPSPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user WriteAccountRestrictions privileges
  cypher: |-
    MATCH (n:User)-[r:WriteAccountRestrictions]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has WriteAccountRestrictions over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all user WriteDacl privileges
  cypher: |-
    MATCH (n:User)-[r:WriteDacl]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has WriteDacl over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user WriteGPLink privileges
  cypher: |-
    MATCH (n:User)-[r:WriteGPLink]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has WriteGPLink over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user WriteOwner privileges
  cypher: |-
    MATCH (n:User)-[r:WriteOwner]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has WriteOwner over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all user WriteOwnerLimitedRights privileges
  cypher: |-
    MATCH (n:User)-[r:WriteOwnerLimitedRights]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has WriteOwnerLimitedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all user WriteSPN privileges
  cypher: |-
    MATCH (n:User)-[r:WriteSPN]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has WriteSPN over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all users
  cypher: |-
    MATCH (n:User)
    RETURN n.name AS n_name
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }}
- group: general
  desc: List all users that don't require a password
  cypher: |-
    MATCH (n:User {passwordnotreqd: true})
    RETURN n.name AS n_name
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} is not required to have a password
- group: general
  desc: List all users that don't require a password for owned principals
  cypher: |-
    MATCH (n:User {passwordnotreqd: true, owned: true})
    RETURN n.name AS n_name
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} is not required to have a password
- group: general
  desc: List all users where password never expires
  cypher: |-
    MATCH (n:User {pwdneverexpires: true})
    RETURN n.name AS n_name
    ORDER BY n.name
  msg_template: |-
    User's {{ n_name }} password is set to never expire
- group: general
  desc: List all users where password never expires for owned principals
  cypher: |-
    MATCH (n:User {pwdneverexpires: true, owned: true})
    RETURN n.name AS n_name
    ORDER BY n.name
  msg_template: |-
    User's {{ n_name }} password is set to never expire
- group: general
  desc: List all users with an admin count
  cypher: |-
    MATCH (m:User {admincount: true})
    RETURN m.name AS m_name
    ORDER BY m.name
  msg_template: |-
    User {{ m_name }} has an admin count
- group: general
  desc: List all users with passwords older than 1 year (pwdLastSet)
  cypher: |-
    WITH 365 as days_since_change
    MATCH (u:User)
    WHERE u.pwdlastset < (datetime().epochseconds - (days_since_change * 86400))
      AND NOT u.pwdlastset IN [-1.0, 0.0]
    RETURN u.name AS u_name, u.pwdlastset AS u_pwdlastset, days_since_change
    ORDER BY u.name
  msg_template: |-
    User {{ u_name }} has not changed their password in over {{ days_since_change }} days (pwdlastset={{
    u_pwdlastset }})
- group: general
  desc: List all WriteAccountRestrictions privileges
  cypher: |-
    MATCH (n)-[r:WriteAccountRestrictions]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has WriteAccountRestrictions over {{ m_name }}
    ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all WriteAccountRestrictions privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:WriteAccountRestrictions]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has WriteAccountRestrictions over {{ m_name }}
    ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all WriteAccountRestrictions privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:WriteAccountRestrictions]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteAccountRestrictions over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all WriteDacl privileges
  cypher: |-
    MATCH (n)-[r:WriteDacl]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has WriteDacl over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all WriteDacl privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:WriteDacl]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has WriteDacl over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all WriteDacl privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:WriteDacl]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteDacl over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all WriteGPLink privileges
  cypher: |-
    MATCH (n)-[r:WriteGPLink]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has WriteGPLink over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all WriteGPLink privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:WriteGPLink]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has WriteGPLink over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all WriteGPLink privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:WriteGPLink]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteGPLink over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all WriteOwner privileges
  cypher: |-
    MATCH (n)-[r:WriteOwner]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has WriteOwner over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all WriteOwner privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:WriteOwner]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has WriteOwner over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all WriteOwner privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:WriteOwner]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteOwner over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all WriteOwnerLimitedRights privileges
  cypher: |-
    MATCH (n)-[r:WriteOwnerLimitedRights]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has WriteOwnerLimitedRights over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all WriteOwnerLimitedRights privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:WriteOwnerLimitedRights]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has WriteOwnerLimitedRights over {{ m_name }} ({{
    labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List all WriteOwnerLimitedRights privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:WriteOwnerLimitedRights]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteOwnerLimitedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: general
  desc: List all WriteSPN privileges
  cypher: |-
    MATCH (n)-[r:WriteSPN]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has WriteSPN over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all WriteSPN privileges for owned principals
  cypher: |-
    MATCH (n {owned: true})-[r:WriteSPN]->(m)
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) has WriteSPN over {{ m_name }} ({{ labels_m[0]
    }}/{{ labels_m[1] }})
- group: general
  desc: List all WriteSPN privileges for Users, Domain Users, Authenticated Users, and Everyone groups
  cypher: |-
    MATCH (n:Group)-[r:WriteSPN]->(m)
    WHERE (n.objectid =~ "(?i)S-1-5-21-.*-513" OR n.objectid =~ "(?i).*-S-1-5-11" OR n.objectid =~ "(?i).*-S-1-1-0" OR n.objectid =~ "(?i).*-S-1-5-32-545")
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteSPN over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List computers containing "dev"
  cypher: |-
    MATCH (c:Computer)
    WHERE c.name =~ '.*((?i)dev).*'
    RETURN c.name AS c_name
    ORDER BY c.name
  msg_template: |-
    Dev computer {{ c_name }}
- group: general
  desc: List computers containing "prod"
  cypher: |-
    MATCH (c:Computer)
    WHERE c.name =~ '.*((?i)prod).*'
    RETURN c.name AS c_name
    ORDER BY c.name
  msg_template: |-
    Prod computer {{ c_name }}
- group: general
  desc: List computers containing "sql"
  cypher: |-
    MATCH (c:Computer)
    WHERE c.name =~ '.*((?i)sql).*'
    RETURN c.name AS c_name
    ORDER BY c.name
  msg_template: |-
    SQL computer {{ c_name }}
- group: general
  desc: List computers containing "web"
  cypher: |-
    MATCH (c:Computer)
    WHERE c.name =~ '.*((?i)web).*'
    RETURN c.name AS c_name
    ORDER BY c.name
  msg_template: |-
    Web computer {{ c_name }}
- group: general
  desc: List computers with LAPS disabled
  cypher: |-
    MATCH (c:Computer)
    WHERE c.haslaps = false
    RETURN c.name AS c_name
    ORDER BY c.name
  msg_template: |-
    Computer {{ c_name }} has LAPS disabled
- group: general
  desc: List computers with LAPS enabled
  cypher: |-
    MATCH (c:Computer)
    WHERE c.haslaps = true
    RETURN c.name AS c_name
    ORDER BY c.name
  msg_template: |-
    Computer {{ c_name }} has LAPS enabled
- group: general
  desc: List Domain Admin sessions
  cypher: |-
    MATCH (n:User)-[:MemberOf*1..]->(g:Group)
    WHERE g.objectid ENDS
    WITH '-512'
    MATCH p = (c:Computer)-[:HasSession]->(n)
    RETURN n.name AS n_name, c.name AS c_name
    ORDER BY n.name
  msg_template: |-
    Domain admin {{ n_name }} HasSession on {{ c_name }}
- group: general
  desc: List Enterprise Admin sessions
  cypher: |-
    MATCH (n:User)-[:MemberOf*1..]->(g:Group)
    WHERE g.objectid ENDS
    WITH '-519'
    MATCH p = (c:Computer)-[:HasSession]->(n)
    RETURN n.name AS n_name, c.name AS c_name
    ORDER BY n.name
  msg_template: |-
    Enterprise admin {{ n_name }} HasSession on {{ c_name }}
- group: general
  desc: List groups containing "admin"
  cypher: |-
    MATCH (g:Group)
    WHERE g.name =~ '.*((?i)admin|adm).*'
    RETURN g.name AS g_name
    ORDER BY g.name
  msg_template: |-
    Admin group {{ g_name }}
- group: general
  desc: List groups containing "dev"
  cypher: |-
    MATCH (g:Group)
    WHERE g.name =~ '.*((?i)dev).*'
    RETURN g.name AS g_name
    ORDER BY g.name
  msg_template: |-
    Dev group {{ g_name }}
- group: general
  desc: List groups containing "prod"
  cypher: |-
    MATCH (g:Group)
    WHERE g.name =~ '.*((?i)prod).*'
    RETURN g.name AS g_name
    ORDER BY g.name
  msg_template: |-
    Prod group {{ g_name }}
- group: general
  desc: List groups containing "sql"
  cypher: |-
    MATCH (g:Group)
    WHERE g.name =~ '.*((?i)sql).*'
    RETURN g.name AS g_name
    ORDER BY g.name
  msg_template: |-
    SQL group {{ g_name }}
- group: general
  desc: List groups containing "svc/service"
  cypher: |-
    MATCH (g:Group)
    WHERE g.name =~ '.*((?i)svc|service).*'
    RETURN g.name AS g_name
    ORDER BY g.name
  msg_template: |-
    Service group {{ g_name }}
- group: general
  desc: List groups containing "web"
  cypher: |-
    MATCH (g:Group)
    WHERE g.name =~ '.*((?i)web).*'
    RETURN g.name AS g_name
    ORDER BY g.name
  msg_template: |-
    Web group {{ g_name }}
- group: user
  desc: List if this user's AS-REP roastable
  cypher: |-
    MATCH (u:User {dontreqpreauth: true})
    WHERE u.name =~ '((?i){{ params.user }})'
    RETURN u.name AS u_name
  msg_template: |-
    User {{ u_name }} is AS-REP roastable
- group: user
  desc: List if this user's kerberoastable
  cypher: |-
    MATCH (n:User)
    WHERE n.hasspn=true AND n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS result
    ORDER BY n.name
  msg_template: |-
    User {{ result }} is kerberoastable
- group: general
  desc: List potential passwords in descriptions
  cypher: |-
    MATCH (u:User)
    WHERE u.description =~ '.*((?i)pass|pw|:).*'
    RETURN u.name AS u_name, u.description AS u_description
    ORDER BY u.name
  msg_template: |-
    User {{ u_name }} may have password in description {{ u_description }}
- group: computer
  desc: List this computer's AbuseTGTDelegation privileges
  cypher: |-
    MATCH (n:Computer)-[r:AbuseTGTDelegation]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has AbuseTGTDelegation over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's ADCSESC1 privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC1]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC1 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's ADCSESC10a privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC10a]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC10a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's ADCSESC10b privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC10b]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC10b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's ADCSESC13 privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC13]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC13 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's ADCSESC3 privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC3]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC3 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's ADCSESC4 privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC4]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC4 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's ADCSESC6a privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC6a]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC6a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's ADCSESC6b privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC6b]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC6b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's ADCSESC9a privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC9a]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC9a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's ADCSESC9b privileges
  cypher: |-
    MATCH (n:Computer)-[r:ADCSESC9b]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ADCSESC9b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's AddAllowedToAct privileges
  cypher: |-
    MATCH (n:Computer)-[r:AddAllowedToAct]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has AddAllowedToAct over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's AddKeyCredentialLink privileges
  cypher: |-
    MATCH (n:Computer)-[r:AddKeyCredentialLink]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has AddKeyCredentialLink over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: computer
  desc: List this computer's AddMember privileges
  cypher: |-
    MATCH (n:Computer)-[r:AddMember]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has AddMember over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's AddSelf privileges
  cypher: |-
    MATCH (n:Computer)-[r:AddSelf]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has AddSelf over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's AdminTo privileges
  cypher: |-
    MATCH (n:Computer)-[r:AdminTo]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has AdminTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's AllExtendedRights privileges
  cypher: |-
    MATCH (n:Computer)-[r:AllExtendedRights]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has AllExtendedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's AllowedToAct privileges
  cypher: |-
    MATCH (n:Computer)-[r:AllowedToAct]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} is AllowedToAct for {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's AllowedToDelegate privileges
  cypher: |-
    MATCH (n:Computer)-[r:AllowedToDelegate]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has AllowedToDelegate over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's CanApplyGPO privileges
  cypher: |-
    MATCH (n:Computer)-[r:CanApplyGPO]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has CanApplyGPO over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's CanPSRemote privileges
  cypher: |-
    MATCH (n:Computer)-[r:CanPSRemote]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has CanPSRemote over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's CanRDP privileges
  cypher: |-
    MATCH (n:Computer)-[r:CanRDP]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has CanRDP over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's CoerceAndRelayNTLMToADCS privileges
  cypher: |-
    MATCH (n:Computer)-[r:CoerceAndRelayNTLMToADCS]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has CoerceAndRelayNTLMToADCS over {{ m_name }} ({{ labels_m[0] }}/{{
    labels_m[1] }})
- group: computer
  desc: List this computer's CoerceAndRelayNTLMToLDAP privileges
  cypher: |-
    MATCH (n:Computer)-[r:CoerceAndRelayNTLMToLDAP]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has CoerceAndRelayNTLMToLDAP over {{ m_name }} ({{ labels_m[0] }}/{{
    labels_m[1] }})
- group: computer
  desc: List this computer's CoerceAndRelayNTLMToLDAPS privileges
  cypher: |-
    MATCH (n:Computer)-[r:CoerceAndRelayNTLMToLDAPS]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has CoerceAndRelayNTLMToLDAPS over {{ m_name }} ({{ labels_m[0] }}/{{
    labels_m[1] }})
- group: computer
  desc: List this computer's CoerceAndRelayNTLMToSMB privileges
  cypher: |-
    MATCH (n:Computer)-[r:CoerceAndRelayNTLMToSMB]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has CoerceAndRelayNTLMToSMB over {{ m_name }} ({{ labels_m[0] }}/{{
    labels_m[1] }})
- group: computer
  desc: List this computer's CoerceToTGT privileges
  cypher: |-
    MATCH (n:Computer)-[r:CoerceToTGT]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has CoerceToTGT over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's ContainsIdentity privileges
  cypher: |-
    MATCH (n:Computer)-[r:ContainsIdentity]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ContainsIdentity over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's DCSync privileges
  cypher: |-
    MATCH (n:Computer)-[r:DCSync|AllExtendedRights|GenericAll]->(m:Domain)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, type(r) AS rel_type
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has {{ rel_type }} over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's DumpSMSAPassword privileges
  cypher: |-
    MATCH (n:Computer)-[r:DumpSMSAPassword]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has DumpSMSAPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's ExecuteDCOM privileges
  cypher: |-
    MATCH (n:Computer)-[r:ExecuteDCOM]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ExecuteDCOM over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's ForceChangePassword privileges
  cypher: |-
    MATCH (n:Computer)-[r:ForceChangePassword]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ForceChangePassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: computer
  desc: List this computer's GenericAll privileges
  cypher: |-
    MATCH (n:Computer)-[r:GenericAll]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has GenericAll over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's GenericWrite privileges
  cypher: |-
    MATCH (n:Computer)-[r:GenericWrite]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has GenericWrite over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's GoldenCert privileges
  cypher: |-
    MATCH (n:Computer)-[r:GoldenCert]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has GoldenCert over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's GPOAppliesTo privileges
  cypher: |-
    MATCH (n:Computer)-[r:GPOAppliesTo]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has GPOAppliesTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's group memberships
  cypher: |-
    MATCH (n:Computer)-[r:MemberOf]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} is MemberOf {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's group-delegated AdminTo privileges
  cypher: |-
    MATCH (n:Computer)-[:MemberOf]->(m:Group),(m)-[:AdminTo]->(c:Computer)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN DISTINCT n.name AS DISTINCT_n_name, m.name AS m_name, c.name AS c_name
    ORDER BY m.name
  msg_template: |-
    Computer {{ n.name }} is MemberOf {{ m_name }} which is AdminTo {{ c_name }}
- group: computer
  desc: List this computer's HasSession privileges
  cypher: |-
    MATCH (n:Computer)-[r:HasSession]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has HasSession over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's HasSIDHistory privileges
  cypher: |-
    MATCH (n:Computer)-[r:HasSIDHistory]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has HasSIDHistory over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's HasTrustKeys privileges
  cypher: |-
    MATCH (n:Computer)-[r:HasTrustKeys]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has HasTrustKeys over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's Owns privileges
  cypher: |-
    MATCH (n:Computer)-[r:Owns]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} Owns {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's OwnsLimitedRights privileges
  cypher: |-
    MATCH (n:Computer)-[r:OwnsLimitedRights]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has OwnsLimitedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's PropagatesACEsTo privileges
  cypher: |-
    MATCH (n:Computer)-[r:PropagatesACEsTo]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has PropagatesACEsTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's ReadGMSAPassword privileges
  cypher: |-
    MATCH (n:Computer)-[r:ReadGMSAPassword]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ReadGMSAPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's ReadLAPSPassword privileges
  cypher: |-
    MATCH (n:Computer)-[r:ReadLAPSPassword]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has ReadLAPSPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's SpoofSIDHistory privileges
  cypher: |-
    MATCH (n:Computer)-[r:SpoofSIDHistory]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has SpoofSIDHistory over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's SQLAdmin privileges
  cypher: |-
    MATCH (n:Computer)-[r:SQLAdmin]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has SQLAdmin over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's SyncedToEntraUser privileges
  cypher: |-
    MATCH (n:Computer)-[r:SyncedToEntraUser]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has SyncedToEntraUser over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's SyncLAPSPassword privileges
  cypher: |-
    MATCH (n:Computer)-[r:SyncLAPSPassword]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has SyncLAPSPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's WriteAccountRestrictions privileges
  cypher: |-
    MATCH (n:Computer)-[r:WriteAccountRestrictions]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has WriteAccountRestrictions over {{ m_name }} ({{ labels_m[0] }}/{{
    labels_m[1] }})
- group: computer
  desc: List this computer's WriteDacl privileges
  cypher: |-
    MATCH (n:Computer)-[r:WriteDacl]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has WriteDacl over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's WriteGPLink privileges
  cypher: |-
    MATCH (n:Computer)-[r:WriteGPLink]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has WriteGPLink over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's WriteOwner privileges
  cypher: |-
    MATCH (n:Computer)-[r:WriteOwner]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has WriteOwner over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: computer
  desc: List this computer's WriteOwnerLimitedRights privileges
  cypher: |-
    MATCH (n:Computer)-[r:WriteOwnerLimitedRights]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has WriteOwnerLimitedRights over {{ m_name }} ({{ labels_m[0] }}/{{
    labels_m[1] }})
- group: computer
  desc: List this computer's WriteSPN privileges
  cypher: |-
    MATCH (n:Computer)-[r:WriteSPN]->(m)
    WHERE n.name =~ '((?i){{ params.computer }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} has WriteSPN over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's AbuseTGTDelegation privileges
  cypher: |-
    MATCH (n:Group)-[r:AbuseTGTDelegation]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AbuseTGTDelegation over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's ADCSESC1 privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC1]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC1 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's ADCSESC10a privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC10a]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC10a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's ADCSESC10b privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC10b]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC10b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's ADCSESC13 privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC13]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC13 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's ADCSESC3 privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC3]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC3 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's ADCSESC4 privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC4]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC4 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's ADCSESC6a privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC6a]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC6a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's ADCSESC6b privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC6b]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC6b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's ADCSESC9a privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC9a]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC9a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's ADCSESC9b privileges
  cypher: |-
    MATCH (n:Group)-[r:ADCSESC9b]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ADCSESC9b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's AddAllowedToAct privileges
  cypher: |-
    MATCH (n:Group)-[r:AddAllowedToAct]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AddAllowedToAct over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's AddKeyCredentialLink privileges
  cypher: |-
    MATCH (n:Group)-[r:AddKeyCredentialLink]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AddKeyCredentialLink over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's AddMember privileges
  cypher: |-
    MATCH (n:Group)-[r:AddMember]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AddMember over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's AddSelf privileges
  cypher: |-
    MATCH (n:Group)-[r:AddSelf]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AddSelf over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's AdminTo privileges
  cypher: |-
    MATCH (n:Group)-[r:AdminTo]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AdminTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's AllExtendedRights privileges
  cypher: |-
    MATCH (n:Group)-[r:AllExtendedRights]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AllExtendedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's AllowedToAct privileges
  cypher: |-
    MATCH (n:Group)-[r:AllowedToAct]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} is AllowedToAct for {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's AllowedToDelegate privileges
  cypher: |-
    MATCH (n:Group)-[r:AllowedToDelegate]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has AllowedToDelegate over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's CanApplyGPO privileges
  cypher: |-
    MATCH (n:Group)-[r:CanApplyGPO]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CanApplyGPO over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's CanPSRemote privileges
  cypher: |-
    MATCH (n:Group)-[r:CanPSRemote]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CanPSRemote over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's CanRDP privileges
  cypher: |-
    MATCH (n:Group)-[r:CanRDP]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CanRDP over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's CoerceAndRelayNTLMToADCS privileges
  cypher: |-
    MATCH (n:Group)-[r:CoerceAndRelayNTLMToADCS]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CoerceAndRelayNTLMToADCS over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: group
  desc: List this group's CoerceAndRelayNTLMToLDAP privileges
  cypher: |-
    MATCH (n:Group)-[r:CoerceAndRelayNTLMToLDAP]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CoerceAndRelayNTLMToLDAP over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: group
  desc: List this group's CoerceAndRelayNTLMToLDAPS privileges
  cypher: |-
    MATCH (n:Group)-[r:CoerceAndRelayNTLMToLDAPS]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CoerceAndRelayNTLMToLDAPS over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: group
  desc: List this group's CoerceAndRelayNTLMToSMB privileges
  cypher: |-
    MATCH (n:Group)-[r:CoerceAndRelayNTLMToSMB]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CoerceAndRelayNTLMToSMB over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: group
  desc: List this group's CoerceToTGT privileges
  cypher: |-
    MATCH (n:Group)-[r:CoerceToTGT]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has CoerceToTGT over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's ContainsIdentity privileges
  cypher: |-
    MATCH (n:Group)-[r:ContainsIdentity]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ContainsIdentity over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's DCSync privileges
  cypher: |-
    MATCH (n:Group)-[r:DCSync|AllExtendedRights|GenericAll]->(m:Domain)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, type(r) AS rel_type
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has {{ rel_type }} over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's description
  cypher: |-
    MATCH (g:Group)
    WHERE g.name =~ '((?i){{ params.group }})'
    RETURN g.name AS g_name, g.description AS g_description
    ORDER BY g.name
  msg_template: |-
    Group {{ g_name }} description {{ g_description }}
- group: group
  desc: List this group's DumpSMSAPassword privileges
  cypher: |-
    MATCH (n:Group)-[r:DumpSMSAPassword]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has DumpSMSAPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's ExecuteDCOM privileges
  cypher: |-
    MATCH (n:Group)-[r:ExecuteDCOM]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ExecuteDCOM over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's ForceChangePassword privileges
  cypher: |-
    MATCH (n:Group)-[r:ForceChangePassword]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ForceChangePassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's GenericAll privileges
  cypher: |-
    MATCH (n:Group)-[r:GenericAll]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has GenericAll over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's GenericWrite privileges
  cypher: |-
    MATCH (n:Group)-[r:GenericWrite]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has GenericWrite over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's GoldenCert privileges
  cypher: |-
    MATCH (n:Group)-[r:GoldenCert]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has GoldenCert over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's GPOAppliesTo privileges
  cypher: |-
    MATCH (n:Group)-[r:GPOAppliesTo]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has GPOAppliesTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's group memberships
  cypher: |-
    MATCH (n:Group)-[r:MemberOf]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} is MemberOf {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's group-delegated AdminTo privileges
  cypher: |-
    MATCH (n:Group)-[:MemberOf]->(m:Group),(m)-[:AdminTo]->(c:Computer)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN DISTINCT n.name AS DISTINCT_n_name, m.name AS m_name, c.name AS c_name
    ORDER BY m.name
  msg_template: |-
    Group {{ n.name }} is MemberOf {{ m_name }} which is AdminTo {{ c_name }}
- group: group
  desc: List this group's group-delegated RDP privileges
  cypher: |-
    MATCH (n:Group)-[:MemberOf]->(m:Group),(m)-[:CanRDP]->(c:Computer)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN DISTINCT n.name AS DISTINCT_n_name, m.name AS m_name, c.name AS c_name
    ORDER BY m.name
  msg_template: |-
    Group {{ n.name }} is MemberOf {{ m_name }} which CanRDP to {{ c_name }}
- group: group
  desc: List this group's HasSession privileges
  cypher: |-
    MATCH (n:Group)-[r:HasSession]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has HasSession over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's HasSIDHistory privileges
  cypher: |-
    MATCH (n:Group)-[r:HasSIDHistory]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has HasSIDHistory over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's HasTrustKeys privileges
  cypher: |-
    MATCH (n:Group)-[r:HasTrustKeys]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has HasTrustKeys over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's members
  cypher: |-
    MATCH (n)-[r:MemberOf]->(m)
    WHERE m.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, labels(n) AS labels_n
    ORDER BY n.name
  msg_template: |-
    {{ n_name }} ({{ labels_n[0] }}/{{ labels_n[1] }}) is MemberOf {{ m_name }} ({{ labels_m[0] }}/{{
    labels_m[1] }})
- group: group
  desc: List this group's Owns privileges
  cypher: |-
    MATCH (n:Group)-[r:Owns]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} Owns {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's OwnsLimitedRights privileges
  cypher: |-
    MATCH (n:Group)-[r:OwnsLimitedRights]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has OwnsLimitedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's PropagatesACEsTo privileges
  cypher: |-
    MATCH (n:Group)-[r:PropagatesACEsTo]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has PropagatesACEsTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's RDP privileges
  cypher: |-
    MATCH p=(g:Group)-[:CanRDP]->(c:Computer)
    WHERE g.name =~ '((?i){{ params.group }})'
    RETURN g.name AS g_name, c.name AS c_name
  msg_template: |-
    Group {{ g_name }} CanRDP to {{ c_name }}
- group: group
  desc: List this group's ReadGMSAPassword privileges
  cypher: |-
    MATCH (n:Group)-[r:ReadGMSAPassword]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ReadGMSAPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's ReadLAPSPassword privileges
  cypher: |-
    MATCH (n:Group)-[r:ReadLAPSPassword]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has ReadLAPSPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's SpoofSIDHistory privileges
  cypher: |-
    MATCH (n:Group)-[r:SpoofSIDHistory]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has SpoofSIDHistory over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's SQLAdmin privileges
  cypher: |-
    MATCH (n:Group)-[r:SQLAdmin]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has SQLAdmin over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's SyncedToEntraUser privileges
  cypher: |-
    MATCH (n:Group)-[r:SyncedToEntraUser]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has SyncedToEntraUser over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's SyncLAPSPassword privileges
  cypher: |-
    MATCH (n:Group)-[r:SyncLAPSPassword]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has SyncLAPSPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's WriteAccountRestrictions privileges
  cypher: |-
    MATCH (n:Group)-[r:WriteAccountRestrictions]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteAccountRestrictions over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: group
  desc: List this group's WriteDacl privileges
  cypher: |-
    MATCH (n:Group)-[r:WriteDacl]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteDacl over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's WriteGPLink privileges
  cypher: |-
    MATCH (n:Group)-[r:WriteGPLink]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteGPLink over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's WriteOwner privileges
  cypher: |-
    MATCH (n:Group)-[r:WriteOwner]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteOwner over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: group
  desc: List this group's WriteOwnerLimitedRights privileges
  cypher: |-
    MATCH (n:Group)-[r:WriteOwnerLimitedRights]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteOwnerLimitedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: group
  desc: List this group's WriteSPN privileges
  cypher: |-
    MATCH (n:Group)-[r:WriteSPN]->(m)
    WHERE n.name =~ '((?i){{ params.group }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} has WriteSPN over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's AbuseTGTDelegation privileges
  cypher: |-
    MATCH (n:User)-[r:AbuseTGTDelegation]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has AbuseTGTDelegation over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's ADCSESC1 privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC1]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC1 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's ADCSESC10a privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC10a]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC10a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's ADCSESC10b privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC10b]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC10b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's ADCSESC13 privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC13]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC13 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's ADCSESC3 privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC3]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC3 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's ADCSESC4 privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC4]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC4 over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's ADCSESC6a privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC6a]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC6a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's ADCSESC6b privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC6b]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC6b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's ADCSESC9a privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC9a]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC9a over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's ADCSESC9b privileges
  cypher: |-
    MATCH (n:User)-[r:ADCSESC9b]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ADCSESC9b over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's AddAllowedToAct privileges
  cypher: |-
    MATCH (n:User)-[r:AddAllowedToAct]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has AddAllowedToAct over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's AddKeyCredentialLink privileges
  cypher: |-
    MATCH (n:User)-[r:AddKeyCredentialLink]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has AddKeyCredentialLink over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's AddMember privileges
  cypher: |-
    MATCH (n:User)-[r:AddMember]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has AddMember over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's AddSelf privileges
  cypher: |-
    MATCH (n:User)-[r:AddSelf]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has AddSelf over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's AdminTo privileges
  cypher: |-
    MATCH (n:User)-[r:AdminTo]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has AdminTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's AllExtendedRights privileges
  cypher: |-
    MATCH (n:User)-[r:AllExtendedRights]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has AllExtendedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's AllowedToAct privileges
  cypher: |-
    MATCH (n:User)-[r:AllowedToAct]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} is AllowedToAct for {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's AllowedToDelegate privileges
  cypher: |-
    MATCH (n:User)-[r:AllowedToDelegate]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has AllowedToDelegate over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's CanApplyGPO privileges
  cypher: |-
    MATCH (n:User)-[r:CanApplyGPO]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has CanApplyGPO over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's CanPSRemote privileges
  cypher: |-
    MATCH (n:User)-[r:CanPSRemote]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has CanPSRemote over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's CanRDP privileges
  cypher: |-
    MATCH (n:User)-[r:CanRDP]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has CanRDP over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's CoerceAndRelayNTLMToADCS privileges
  cypher: |-
    MATCH (n:User)-[r:CoerceAndRelayNTLMToADCS]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has CoerceAndRelayNTLMToADCS over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: user
  desc: List this user's CoerceAndRelayNTLMToLDAP privileges
  cypher: |-
    MATCH (n:User)-[r:CoerceAndRelayNTLMToLDAP]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has CoerceAndRelayNTLMToLDAP over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: user
  desc: List this user's CoerceAndRelayNTLMToLDAPS privileges
  cypher: |-
    MATCH (n:User)-[r:CoerceAndRelayNTLMToLDAPS]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has CoerceAndRelayNTLMToLDAPS over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: user
  desc: List this user's CoerceAndRelayNTLMToSMB privileges
  cypher: |-
    MATCH (n:User)-[r:CoerceAndRelayNTLMToSMB]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has CoerceAndRelayNTLMToSMB over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: user
  desc: List this user's CoerceToTGT privileges
  cypher: |-
    MATCH (n:User)-[r:CoerceToTGT]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has CoerceToTGT over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's ContainsIdentity privileges
  cypher: |-
    MATCH (n:User)-[r:ContainsIdentity]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ContainsIdentity over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's DCSync privileges
  cypher: |-
    MATCH (n:User)-[r:DCSync|AllExtendedRights|GenericAll]->(m:Domain)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m, type(r) AS rel_type
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has {{ rel_type }} over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's description
  cypher: |-
    MATCH (u:User)
    WHERE u.name =~ '((?i){{ params.user }})'
    RETURN u.name AS u_name, u.description AS u_description
    ORDER BY u.name
  msg_template: |-
    User {{ u_name }} description {{ u_description }}
- group: user
  desc: List this user's DumpSMSAPassword privileges
  cypher: |-
    MATCH (n:User)-[r:DumpSMSAPassword]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has DumpSMSAPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's email
  cypher: |-
    MATCH (u:User)
    WHERE u.name =~ '((?i){{ params.user }})'
    RETURN u.name AS u_name, u.email AS u_email
    ORDER BY u.name
  msg_template: |-
    User {{ u_name }} email {{ u_email }}
- group: user
  desc: List this user's ExecuteDCOM privileges
  cypher: |-
    MATCH (n:User)-[r:ExecuteDCOM]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ExecuteDCOM over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's ForceChangePassword privileges
  cypher: |-
    MATCH (n:User)-[r:ForceChangePassword]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ForceChangePassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's GenericAll privileges
  cypher: |-
    MATCH (n:User)-[r:GenericAll]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has GenericAll over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's GenericWrite privileges
  cypher: |-
    MATCH (n:User)-[r:GenericWrite]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has GenericWrite over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's GoldenCert privileges
  cypher: |-
    MATCH (n:User)-[r:GoldenCert]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has GoldenCert over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's GPOAppliesTo privileges
  cypher: |-
    MATCH (n:User)-[r:GPOAppliesTo]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has GPOAppliesTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's group memberships
  cypher: |-
    MATCH (n:User)-[r:MemberOf]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} is MemberOf {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's group-delegated AdminTo privileges
  cypher: |-
    MATCH (n:User)-[:MemberOf]->(m:Group),(m)-[:AdminTo]->(c:Computer)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN DISTINCT n.name AS DISTINCT_n_name, m.name AS m_name, c.name AS c_name
    ORDER BY m.name
  msg_template: |-
    User {{ n.name }} is MemberOf {{ m_name }} which is AdminTo {{ c_name }}
- group: user
  desc: List this user's group-delegated RDP privileges
  cypher: |-
    MATCH (n:User)-[:MemberOf]->(m:Group),(m)-[:CanRDP]->(c:Computer)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN DISTINCT n.name AS DISTINCT_n_name, m.name AS m_name, c.name AS c_name
    ORDER BY m.name
  msg_template: |-
    User {{ n.name }} is MemberOf {{ m_name }} which CanRDP to {{ c_name }}
- group: user
  desc: List this user's HasSession privileges
  cypher: |-
    MATCH (n:User)-[r:HasSession]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has HasSession over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's HasSIDHistory privileges
  cypher: |-
    MATCH (n:User)-[r:HasSIDHistory]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has HasSIDHistory over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's HasTrustKeys privileges
  cypher: |-
    MATCH (n:User)-[r:HasTrustKeys]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has HasTrustKeys over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's Owns privileges
  cypher: |-
    MATCH (n:User)-[r:Owns]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} Owns {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's OwnsLimitedRights privileges
  cypher: |-
    MATCH (n:User)-[r:OwnsLimitedRights]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has OwnsLimitedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's PropagatesACEsTo privileges
  cypher: |-
    MATCH (n:User)-[r:PropagatesACEsTo]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has PropagatesACEsTo over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's RDP privileges
  cypher: |-
    MATCH p=(u:User)-[:CanRDP]->(c:Computer)
    WHERE u.name =~ '((?i){{ params.user }})'
    RETURN u.name AS u_name, c.name AS c_name
  msg_template: |-
    User {{ u_name }} CanRDP to {{ c_name }}
- group: user
  desc: List this user's ReadGMSAPassword privileges
  cypher: |-
    MATCH (n:User)-[r:ReadGMSAPassword]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ReadGMSAPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's ReadLAPSPassword privileges
  cypher: |-
    MATCH (n:User)-[r:ReadLAPSPassword]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has ReadLAPSPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's sessions
  cypher: |-
    MATCH p=(m:Computer)-[r:HasSession]->(n:User)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name
  msg_template: |-
    User {{ n_name }} HasSession on {{ m_name }}
- group: user
  desc: List this user's SpoofSIDHistory privileges
  cypher: |-
    MATCH (n:User)-[r:SpoofSIDHistory]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has SpoofSIDHistory over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's SQLAdmin privileges
  cypher: |-
    MATCH (n:User)-[r:SQLAdmin]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has SQLAdmin over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's SyncedToEntraUser privileges
  cypher: |-
    MATCH (n:User)-[r:SyncedToEntraUser]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has SyncedToEntraUser over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's SyncLAPSPassword privileges
  cypher: |-
    MATCH (n:User)-[r:SyncLAPSPassword]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has SyncLAPSPassword over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's WriteAccountRestrictions privileges
  cypher: |-
    MATCH (n:User)-[r:WriteAccountRestrictions]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has WriteAccountRestrictions over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: user
  desc: List this user's WriteDacl privileges
  cypher: |-
    MATCH (n:User)-[r:WriteDacl]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has WriteDacl over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's WriteGPLink privileges
  cypher: |-
    MATCH (n:User)-[r:WriteGPLink]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has WriteGPLink over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's WriteOwner privileges
  cypher: |-
    MATCH (n:User)-[r:WriteOwner]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has WriteOwner over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: user
  desc: List this user's WriteOwnerLimitedRights privileges
  cypher: |-
    MATCH (n:User)-[r:WriteOwnerLimitedRights]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has WriteOwnerLimitedRights over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1]
    }})
- group: user
  desc: List this user's WriteSPN privileges
  cypher: |-
    MATCH (n:User)-[r:WriteSPN]->(m)
    WHERE n.name =~ '((?i){{ params.user }})'
    RETURN n.name AS n_name, m.name AS m_name, labels(m) AS labels_m
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} has WriteSPN over {{ m_name }} ({{ labels_m[0] }}/{{ labels_m[1] }})
- group: general
  desc: List users containing "admin"
  cypher: |-
    MATCH (u:User)
    WHERE u.name =~ '.*((?i)admin|adm).*'
    RETURN u.name AS u_name
    ORDER BY u.name
  msg_template: |-
    Admin user {{ u_name }}
- group: general
  desc: List users containing "dev"
  cypher: |-
    MATCH (u:User)
    WHERE u.name =~ '.*((?i)dev).*'
    RETURN u.name AS u_name
    ORDER BY u.name
  msg_template: |-
    Dev user {{ u_name }}
- group: general
  desc: List users containing "prod"
  cypher: |-
    MATCH (u:User)
    WHERE u.name =~ '.*((?i)prod).*'
    RETURN u.name AS u_name
    ORDER BY u.name
  msg_template: |-
    Prod user {{ u_name }}
- group: general
  desc: List users containing "sql"
  cypher: |-
    MATCH (u:User)
    WHERE u.name =~ '.*((?i)sql).*'
    RETURN u.name AS u_name
    ORDER BY u.name
  msg_template: |-
    SQL user {{ u_name }}
- group: general
  desc: List users containing "svc/service"
  cypher: |-
    MATCH (u:User)
    WHERE u.name =~ '.*((?i)svc|service).*'
    RETURN u.name AS u_name
    ORDER BY u.name
  msg_template: |-
    Service user {{ u_name }}
- group: general
  desc: List users containing "web"
  cypher: |-
    MATCH (u:User)
    WHERE u.name =~ '.*((?i)web).*'
    RETURN u.name AS u_name
    ORDER BY u.name
  msg_template: |-
    Web user {{ u_name }}
- group: regex
  desc: Search for computers matching the regex
  cypher: |-
    MATCH (n:Computer)
    WHERE n.name =~ '{{ params.regex }}'
    RETURN n.name AS n_name
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }}
- group: regex
  desc: Search for Containers matching the regex
  cypher: |-
    MATCH (n:Container)
    WHERE n.name =~ '{{ params.regex }}'
    RETURN n.name AS n_name
    ORDER BY n.name
  msg_template: |-
    Container {{ n_name }}
- group: regex
  desc: Search for GPOs matching the regex
  cypher: |-
    MATCH (n:GPO)
    WHERE n.name =~ '{{ params.regex }}'
    RETURN n.name AS n_name
    ORDER BY n.name
  msg_template: |-
    GPO {{ n_name }}
- group: regex
  desc: Search for group descriptions matching the regex
  cypher: |-
    MATCH (n:Group)
    WHERE n.description =~ '{{ params.regex }}'
    RETURN n.name AS n_name, n.description AS n_description
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }} description {{ n_description }}
- group: regex
  desc: Search for groups matching the regex
  cypher: |-
    MATCH (n:Group)
    WHERE n.name =~ '{{ params.regex }}'
    RETURN n.name AS n_name
    ORDER BY n.name
  msg_template: |-
    Group {{ n_name }}
- group: regex
  desc: Search for OSs matching the regex
  cypher: |-
    MATCH (n:Computer)
    WHERE n.operatingsystem =~ '{{ params.regex }}'
    RETURN n.name AS n_name, n.operatingsystem AS n_operatingsystem
    ORDER BY n.name
  msg_template: |-
    Computer {{ n_name }} OS {{ n_operatingsystem }}
- group: regex
  desc: Search for OUs matching the regex
  cypher: |-
    MATCH (n:OU)
    WHERE n.name =~ '{{ params.regex }}'
    RETURN n.name AS n_name
    ORDER BY n.name
  msg_template: |-
    OU {{ n_name }}
- group: regex
  desc: Search for user descriptions matching the regex
  cypher: |-
    MATCH (n:User)
    WHERE n.description =~ '{{ params.regex }}'
    RETURN n.name AS n_name, n.description AS n_description
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }} description {{ n_description }}
- group: regex
  desc: Search for users matching the regex
  cypher: |-
    MATCH (n:User)
    WHERE n.name =~ '{{ params.regex }}'
    RETURN n.name AS n_name
    ORDER BY n.name
  msg_template: |-
    User {{ n_name }}
